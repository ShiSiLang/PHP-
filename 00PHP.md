#PHP语言基础

## 3.1　PHP标记风格

####PHP支持4种标记风格

```php
XML风格:XML风格的标记是本书所使用的标记，也是推荐使用的标记，服务器不能禁用。该风格的标记在XML、XHTML中都可以使用。
<?php
	echo "这是XML风格的标记";
?>

脚本风格
<script language="php">
	echo '这是脚本风格的标记';
</script>
  
简短风格
<? echo '这是简短风格的标记'; ?>

ASP风格:如果要使用简短风格和ASP风格，需要在php.ini中对其进行配置，打开php.ini文件，将short_open_tag和asp_tags都设置为On，重启Apache服务器即可。
<%
	echo '这是ASP风格的标记';
%>
```



---



## 3.2　PHP注释的应用
`注释即代码的解释和说明，一般放在代码的上方或代码的尾部（放尾部时，代码和注释之间以Tab键进行分隔，以方便程序阅读），用来说明代码或函数的编写人、用途、时间等。注释不会影响到程序的执行，因为在执行时，注释部分会被解释器忽略不计。`


####PHP支持3种风格的程序注释。
```php
单行注释（//）:这是一种来源于C++语言语法的注释模式，可以写在PHP语句的上方，也可以写在后方。
<?php
	//这是写在PHP语句上方的单行注释
	echo '使用C++风格的注释';
?>
<?php
	echo'使用C++风格的注释';           //这是写在PHP语句后面的单行注释
?>


多行注释（/*…*/）:这是一种来源于C语言语法的注释模式，可以分为块注释和文档注释。
多行注释是不允许进行嵌套操作的。

块注释：
<?php
	/＊
	$a = 1;
	$b = 2;
	echo ($a + $b);
	＊/
	echo 'PHP的多行注释';
?>

文档注释：
<?php
	/＊ 说明：项目工具类
	＊ 作者：小辛
	＊ E-mail:mingrisoft@mingrisoft.com
	＊/
	class Util
	{
		/＊＊
		＊ 方法说明：给字符串加前缀
		＊ 参数：String $str
		＊ 返回值：String
		＊/
		function addPrefix ($str)
		{
		    $str.= 'mingri';
		    return $str;
		}
	}
?>


#风格的注释（#）
<?php
	echo'这是#风格的注释';              #这是#风格的单行注释
?>
```


`在单行注释中的内容不要出现“?>”标志，因为解释器会认为PHP脚本结束，而不去执行“?>”后面的代码。`
例如：
```php
<?php
	echo'这样会出错的！！！！！'            //不会看到?>会看到
?>
结果为：这样会出错的！！！！！会看？>
```


##3.3　PHP的数据类型
PHP支持8种原始类型，包括4种标量类型，即`boolean（布尔型）`、`integer（整型）`、`float/double（浮点型）`和`string（字符串型）`；2种复合类型，即`array（数组）`和`object（对象）`；2种特殊类型，即`resource（资源）`与`null`。

`PHP中变量的类型通常不是由程序员设定的，确切地说，是PHP根据该变量使用的上下文在运行时决定的。`


###3.3.1　标量数据类型

**标量数据类型**
类型|说明
---|---
boolean(布尔类型)|这是最简单的数据类型，只有true和false两个值
string(字符串)|字符串就是连续的字符序列，字符的集合
interger(整型)|只能包含整数，只能是整数或者负数
float(浮点型)|浮点类型用于存储数字，和整型不同的是有小数点

####1．布尔型（boolean）
布尔型是PHP中较为常用的数据类型之一，它保存一个true值或者false值，其中true和false是PHP的内部关键字。设定一个布尔型的变量，只需将true或者false赋值给变量即可.
在PHP中不是只有false值才为假的，在一些特殊情况下boolean值也被认为是false。这些特殊情况为`0`、`0.0`、`"0"`、`空白字符串（""）`、`只声明没有赋值的数组`等。

下面在if条件语句中判断变量$boo中的值是否为true，如果为true，则输出“变量$boo为真！”，否则输出“变量$boo为假！！”，实例代码如下： （实例位置：光盘\TM\sl\3\1）
```php
<?php
	$boo=true;                         	//声明一个boolean类型变量，赋初值为true
	if($boo==true)                     	//判断变量$boo是否为真
		echo'变量$boo为真!';             //如果为真，则输出“变量$boo为真!”的字样
	else
    	echo'变量$boo为假!!';           	//如果为假，则输出“变量$boo为假!!”的字样
?>
```
结果为：变量$boo为真！


####2．字符串型（string）
字符串是连续的字符序列，由数字、字母和符号组成。字符串中的每个字符只占用一个字节。在PHP中，有3种定义字符串的方式，分别是单引号（'）、双引号（"）和定界符（<<<）。
单引号和双引号是经常被使用的定义方式，定义格式如下：
```php
<?php
	$a ='字符串';
?>
或
<?php
	$a ="字符串";
?>
```
`两者的不同之处在于，双引号中所包含的变量会自动被替换成实际数值，而单引号中包含的变量则按普通字符串输出。`
`两者之间另一处不同点是对转义字符的使用。使用单引号时，要想输出单引号，只要对单引号（'）进行转义即可，但使用双引号（"）时，还要注意“"”“$”等字符的使用。这些特殊字符都要通过转义符“\”来显示。`

\n和\r在Windows系统中没有什么区别，都可以当作回车符。但在Linux系统中则是两种效果，在Linux中，\n表示换到下一行，却不会回到行首；而\r表示光标回到行首，但仍然在本行。
如果对非转义字符使用了“\”，那么在输出时，“\”也会跟着一起被输出。

`在定义简单的字符串时，使用单引号是一个更加合适的处理方式。如果使用双引号，PHP将花费一些时间来处理字符串的转义和变量的解析。因此，在定义字符串时，如果没有特别的要求，应尽量使用单引号。`

定界符（<<<）是从PHP 4开始支持的。在使用时后接一个标识符，然后是字符串，最后是同样的标识符结束字符串。定界符的格式如下：
```php
$string = <<< str
要输出的字符串
str
```
其中，str为指定的标识符。
结束标识符必须单独另起一行，并且不允许有空格。在标识符前后有其他符号或字符，也会发生错误。


####3．整型（integer）
整型数据类型只能包含整数。在32位的操作系统中，有效的范围是-2147483648～+2147483647。整型数可以用十进制、八进制和十六进制来表示。`如果用八进制，数字前面必须加0；如果用十六进制，则需要加0x。`
如果在八进制中出现了非法数字（8和9），则后面的数字会被忽略掉。
如果给定的数值超出了int型所能表示的最大范围，将会被当作float型处理，这种情况称为整数溢出。同样，如果表达式的最后运算结果超出了int型的范围，也会返回float型。


####4．浮点型（float）
浮点数据类型可以用来存储数字，也可以保存小数。它提供的精度比整数大得多。在32位的操作系统中，有效的范围是1.7E-308～1.7E+308。在PHP 4.0以前的版本中，浮点型的标识为double，也叫作双精度浮点数，两者没有区别。

浮点型数据默认有两种书写格式，一种是标准格式：3.1415,-35.8
还有一种是科学记数法格式：3.58E1,849.72E-3

`浮点型的数值只是一个近似值，所以要尽量避免浮点型数值之间比较大小，因为最后的结果往往是不准确的。`


###3.3.2　复合数据类型

**复合数据类型**
类型|说明
---|---
array（数组）	|一组类型相同的变量的集合
object（对象）|对象是类的实例，使用new命令来创建


####1．数组（array）
数组是一组数据的集合，它把一系列数据组织起来，形成一个可操作的整体。数组中可以包括很多数据，如标量数据、数组、对象、资源以及PHP中支持的其他语法结构等。
数组中的每个数据称为一个元素，元素包括索引（键名）和值两个部分。元素的索引可以由数字或字符串组成，元素的值可以是多种数据类型。定义数组的语法格式如下：
`$array = array('value1',' value2 '…)`或`$array[key] = 'value'`或`$array = array(key1 => value1, key2 => value2…)`
其中，key是数组元素的下标，value是数组下标所对应的元素。以下几种都是正确的格式：
`$arr1 = array('This','is','an','example');`
`$arr2 = array(0 => 'php', 1=>'is', 'the' => 'the', 'str' => 'best ');`
`$arr3[0] = 'tmpname';`
声明数组后，数组中的元素个数还可以自由更改。只要给数组赋值，数组就会自动增加长度。在第7章PHP数组中，会详细介绍数组的使用、取值以及数组的相关函数。

####2．对象（object）
编程语言所应用到的方法有两种：面向过程和面向对象。在PHP中，用户可以自由使用这两种方法。在第13章中将对面向对象的技术进行详细的讲解。


###3.3.3　特殊数据类型

**特殊数据类型**
类型|说明
---|---
resource（资源）|资源是一种特殊变量，又叫作句柄，保存了到外部资源的一个引用。资源是通过专门的函数来建立和使用的
null（空值）|特殊的值，表示变量没有值，唯一的值就是null


####1．资源（resource）
资源类型是PHP 4引进的。关于资源的类型，可以参考PHP手册后面的附录，里面有详细的介绍和说明。
在使用资源时，系统会自动启用垃圾回收机制，释放不再使用的资源，避免内存消耗殆尽。因此，资源很少需要手工释放。

####2．空值（null）
空值，顾名思义，表示没有为该变量设置任何值。另外，空值（null）不区分大小写，null和NULL效果是一样的。
被赋予空值的情况有以下3种：`还没有赋任何值、被赋值null、被unset()函数处理过的变量。`

is_null()函数用于判断变量是否为null，该函数返回一个boolean型，如果变量为null，则返回true，否则返回false。unset()函数用来销毁指定的变量。
从PHP 4开始，unset()函数就不再有返回值，所以不要试图获取或输出unset()。


###3.3.4　数据类型转换

虽然PHP是弱类型语言，但有时仍然需要用到类型转换。PHP中的类型转换和C语言一样，非常简单，只需在变量前加上用括号括起来的类型名称即可。

**类型强制转换**
转换操作符|转换类型|举例
---|---|---
(boolean)|转换成布尔类型|(boolean)$num,(boolean)$str
(string)|转换为字符串类型|(string)$boo, (string)$flo
(integer)|转换为整型|(integer)$boo, (integer)$str
(float)|转换为浮点型|(float)$num, (float)$str
(array)|转换为数组类型|(array)$str
(object)|转换为对象类型|(object)$str

`在进行类型转换的过程中应该注意以下内容：转换成boolean型时，null、0和未赋值的变量或数组会被转换为false，其他的为true；转换成整型时，布尔型的false转换为0，true转换为1，浮点型的小数部分被舍去，字符型如果以数字开头就截取到非数字位，否则输出0。`


类型转换还可以通过settype()函数来完成，该函数可以将指定的变量转换成指定的数据类型。
`bool settype ( mixed var, string type )`
其中，var为指定的变量；type为指定的类型，它有7个可选值，即boolean、float、integer、array、null、object和string。如果转换成功，则返回true，否则返回false。
当字符串转换为整型或浮点型时，如果字符串是以数字开头的，就会先把数字部分转换为整型，再舍去后面的字符串；如果数字中含有小数点，则会取到小数点前一位。


###3.3.5　检测数据类型
PHP内置了检测数据类型的系列函数，可以对不同类型的数据进行检测，判断其是否属于某个类型，如果符合则返回true，否则返回false。

**检测数据类型的函数**



##3.4　PHP常量

###3.4.1　声明和使用常量
常量可以理解为值不变的量。常量值被定义后，在脚本的其他任何地方都不能改变。一个常量由英文字母、下划线和数字组成，但数字不能作为首字母出现。

在PHP中使用define()函数来定义常量，该函数的语法格式如下：
`define(string constant_name,mixed value,case_sensitive=false)`
define()函数的参数说明
参数|说明
---|---
constant_name|必选参数，常量名称，即标识符
value|必选参数，常量的值
case_sensitive|可选参数，指定是否大小写敏感，设定为true，表示不敏感
获取常量的值有两种方法：一种是使用常量名直接获取值；另一种是使用constant()函数。
constant()函数和直接使用常量名输出的效果是一样的，但函数可以动态地输出不同的常量，在使用上要灵活方便得多。
constant()函数的语法格式如下：`mixed constant(string const_name)`
其中，const_name为要获取常量的名称，也可为存储常量名的变量。如果成功则返回常量的值，否则提示错误信息常量没有被定义。

要判断一个常量是否已经定义，可以使用defined()函数，该函数的语法格式如下：
`bool defined(string constant_name);`
其中，constant_name为要获取常量的名称，成功则返回true，否则返回false。


###3.4.2　预定义常量
PHP中可以使用预定义常量获取PHP中的信息。

**常用的预定义常量**

`__FILE__和__LINE__中的“__”是两条下划线，而不是一条“_”。`


##3.5　PHP变量
变量是指在程序执行过程中数值可以变化的量。变量通过一个名字（变量名）来标识。系统为程序中的每一个变量分配一个存储单元，变量名实质上就是计算机内存单元的命名。因此，借助变量名即可访问内存中的数据。

###3.5.1　变量声明及使用
和很多语言不同，在PHP中使用变量之前不需要声明变量（PHP 4之前需要声明变量），只需为变量赋值即可。PHP中的变量名称用$和标识符表示。标识符由字母、数字或下划线组成，并且不能以数字开头。另外，变量名是区分大小写的。

变量赋值，是指给变量一个具体的数据值，对于字符串和数字类型的变量，可以通过“=”来实现。格式为：`<?php $name = value; ?>`

对变量赋值时，要遵循变量命名规则.

除了直接赋值外，还有两种方式可为变量声明或赋值，一种是变量间的赋值。 `<?php $string2=$string1; ?>`  
另一种是引用赋值。从PHP 4开始，PHP引入了“引用赋值”的概念。引用的概念是，用不同的名字访问同一个变量内容。当改变其中一个变量的值时，另一个也跟着发生变化。使用&符号来表示引用。
`<?php  $i="mingribook"; $j=&$i ?>`

`引用和复制的区别在于：复制是将原变量内容复制下来，开辟一个新的内存空间来保存，而引用则是给变量的内容再起一个名字。`
可以这样理解，一些文学爱好者经常会向报纸、杂志投稿，但一般不会用真名，而是笔名，这个笔名就可以看作是一个引用。


###3.5.2　变量作用域
在使用变量时，要符合变量的定义规则。变量必须在有效范围内使用，如果变量超出有效范围，则变量也就失去其意义了。

**变量的作用域**
作用域|说明
---|---
局部变量|在函数的内部定义的变量，其作用域是所在函数
全局变量|被定义在所有函数以外的变量，其作用域是整个PHP文件，但在用户自定义函数内部是不可用的。如果希望在用户自定义函数内部使用全局变量，则要使用global关键字声明
静态变量|能够在函数调用结束后仍保留变量值，当再次回到其作用域时，又可以继续使用原来的值。而一般变量是在函数调用结束后，其存储的数据值将被清除，所占的内存空间被释放。使用静态变量时，先要用关键字static来声明变量，把关键字static放在要定义的变量之前

在函数内部定义的变量，其作用域为所在函数，如果在函数外赋值，将被认为是完全不同的另一个变量。在退出声明变量的函数时，该变量及相应的值就会被清除。

全局变量可以在程序中的任何地方访问，但是在用户自定义函数内部是不可用的。想在用户自定义函数内部使用全局变量，要使用global关键字声明。


###3.5.3　可变变量
可变变量是一种独特的变量，它允许动态改变一个变量名称。其工作原理是该变量的名称由另外一个变量的值来确定，实现过程就是在变量的前面再多加一个美元符号“$”。


###3.5.4　PHP预定义变量
PHP提供了很多非常实用的预定义变量，通过这些预定义变量可以获取用户会话、用户操作系统的环境和本地操作系统的环境等信息。

**预定义变量**


##3.6　PHP运算符

###3.6.1　算术运算符
算术运算（Arithmetic Operators）符是处理四则运算的符号，在数字的处理中应用得最多。

**常用的算术运算符**


###3.6.2　字符串运算符
字符串运算符只有一个，即英文的句号“.”，它将两个字符串连接起来，结合成一个新的字符串。使用过C或Java语言的读者应注意，这里的“+”只用作赋值运算符，而不能用作字符串运算符。


###3.6.3　赋值运算符
赋值运算符是把基本赋值运算符“=”右边的值赋给左边的变量或者常量。

**常用赋值运算符**


###3.6.4　递增或递减运算符
算术运算符适合在有两个或者两个以上不同操作数的场合使用，但是，当只有一个操作数时，使用算术运算符是没有必要的。这时，就可以使用递增运算符“++”或者递减运算符“--”。

递增或递减运算符有两种使用方法，一种是将运算符放在变量前面，即先将变量作加1或减1的运算后再将值赋给原变量，叫作前置递增或递减运算符；另一种是将运算符放在变量后面，即先返回变量的当前值，然后变量的当前值作加1或减1的运算，叫作后置递增或递减运算符。


###3.6.5　位运算符
位逻辑运算符是指对二进制位从低位到高位对齐后进行运算。

**位运算符**



###3.6.6　逻辑运算符
逻辑运算符用来组合逻辑运算的结果，是程序设计中一组非常重要的运算符。

**PHP的逻辑运算符**


`在逻辑运算符中，逻辑与和逻辑或这两个运算符有4种运算符号（&&、and、||和or），其中属于同一个逻辑结构的两个运算符号（例如&&和and）之间却有着不同的优先级。`


###3.6.7　比较运算符
比较运算符就是对变量或表达式的结果进行大小、真假等比较，如果比较结果为真，则返回true，如果为假，则返回false。

**PHP的比较运算符**


`其中，不太常见的是===和！==。$a===$b，说明$a和$b不只是数值上相等，而且两者的类型也一样。！==和===的意义相近，$a ！==$b就是说$a和$b或者数值不等，或者类型不等。`


###3.6.8　条件运算符
条件运算符（?:），也称为三目运算符，用于根据一个表达式在另外两个表达式中选择一个，而不是用来在两个语句或者程序中选择。条件运算符最好放在括号里使用。


###3.6.9　运算符的优先级
所谓运算符的优先级，是指在应用中哪一个运算符先计算，哪一个后计算，与数学的四则运算遵循的“先乘除，后加减”是一个道理。

PHP的运算符在运算中遵循的规则是：优先级高的运算先执行，优先级低的操作后执行，同一优先级的操作按照从左到右的顺序执行。也可以像四则运算那样使用小括号，括号内的运算最先执行。

**运算符的优先级**


##3.7　PHP的表达式
表达式是构成PHP程序语言的基本元素，也是PHP重要的组成元素。在PHP语言中，几乎所写的任何对象都是表达式。最基本的表达式形式是常量和变量。
表达式是PHP最重要的基石。简单但却最精确的定义一个表达式的方式就是“任何有值的东西”。
PHP可以进行连续赋值。
在PHP的代码中，使用分号“；”来区分表达式，表达式也可以包含在括号内。可以这样理解：一个表达式再加上一个分号，就是一条PHP语句。
应用表达式能够做很多事情，如调用一个数组，创建一个类，给变量赋值等。
在编写程序时，应该注意表达式后面的分号“；”不要漏写。


##3.8　PHP函数

###3.8.1　定义和调用函数
函数，就是将一些重复使用到的功能写在一个独立的代码块中，在需要时单独调用。创建函数的基本语法格式为：
`function fun_name($str1,$str2…$strn){	fun_body;	}`
其中，function为声明自定义函数时必须使用到的关键字；fun_name为自定义函数的名称；$str1，$str2…$strn为函数的参数；fun_body为自定义函数的主体，是功能实现部分。

当函数被定义好后，所要做的就是调用这个函数。调用函数的操作十分简单，只需要引用函数名并赋予正确的参数即可完成函数的调用。


###3.8.2　在函数间传递参数
在调用函数时，需要向函数传递参数，被传入的参数称为实参，而函数定义的参数为形参。参数传递的方式有按值传递、按引用传递和默认参数3种。

####1．按值传递方式
将实参的值复制到对应的形参中，在函数内部的操作针对形参进行，操作的结果不会影响到实参，即函数返回后，实参的值不会改变。

####2．按引用传递方式
按引用传递就是将实参的内存地址传递到形参中。这时，在函数内部的所有操作都会影响到实参的值，返回后，实参的值会发生变化。引用传递方式就是传值时在原基础上加&即可。

####3．默认参数（可选参数）方式
还有一种设置参数的方式，即可选参数。可以指定某个参数为可选参数，将可选参数放在参数列表末尾，并且给它指定一个默认值。
当使用默认参数时，默认参数必须放在非默认参数的右侧，否则函数可能出错。

`从PHP 5开始，默认值也可以通过引用传递。`


###3.8.3　从函数中返回值
通常，函数将返回值传递给调用者的方式是使用关键字return。
return将函数的值返回给函数的调用者，即将程序控制权返回到调用者的作用域。如果在全局作用域内使用return关键字，那么将终止脚本的执行。
return语句只能返回一个参数，也即只能返回一个值，不能一次返回多个值。如果要返回多个结果，就要在函数中定义一个数组，将返回值存储在数组中返回。


###3.8.4　变量函数
PHP支持变量函数。函数的调用是通过改变变量名来实现的，通过在变量名后面加上一对小括号，PHP将自动寻找与变量名相同的函数，并且执行它。如果找不到对应的函数，系统将会报错。这个技术可以用于实现回调函数和函数表等。


##3.9　PHP编码规范
###3.9.1　什么是编码规范
`以PHP开发为例，编码规范就是融合了开发人员长时间积累下来的经验，形成了一种良好统一的编程风格，这种良好统一的编程风格会在团队开发或二次开发时起到事半功倍的效果。编码规范是一种总结性的说明和介绍，并不是强制性的规则。从项目长远的发展以及团队效率来考虑，遵守编码规范是十分必要的。`

遵守编码规范的好处如下：
* 编码规范是对团队开发成员的基本要求。
* 开发人员可以了解任何代码，理清程序的状况。
* 提高程序的可读性，有利于相关设计人员交流，提高软件质量。
* 防止新接触PHP的人出于节省时间的需要，自创一套风格并养成终生的习惯。
* 有助于程序的维护，降低软件成本。
* 有利于团队管理，实现团队后备资源的可重用。


###3.9.2　PHP书写规则
####1．缩进
使用制表符（Tab键）缩进，缩进单位为4个空格左右。如果开发工具的种类多样，则需要在开发工具中统一设置。

####2．大括号{}
有两种大括号放置规则是可以使用的：
 　将大括号放到关键字的下方、同列。
    if ($expr)
    {
        …
    }
 　首括号与关键词同行，尾括号与关键字同列。

    if ($expr){
        …
    }
两种方式并无太大差别，但多数人都习惯选择第一种方式。

####3．关键字、小括号、函数、运算符
尽量不要把小括号和关键字紧贴在一起，要用空格隔开它们。如：
    if($expr){                        //if和“(”之间有一个空格
        …
    }
 　小括号和函数要紧贴在一起。以便区分关键字和函数。如：
    round($num)                     //round和“(”之间没有空格
 　运算符与两边的变量或表达式要有一个空格（字符连接运算符“.”除外）。如：
    while($boo==true){              //$boo和“==”，true和“==”之间都有一个空格
        …
    }
 　当代码段较大时，上、下应当加入空白行，两个代码块之间只使用一个空行，禁止使用多行。
 　尽量不要在return返回语句中使用小括号。如：
    return 1;                         //除非是必要，否则不需要使用小括号


###3.9.3　PHP命名规则
就一般约定而言，类、函数和变量的名字应该能够让代码阅读者轻易地知道这些代码的作用，应该避免使用模棱两可的命名。
####1．类命名
* 使用大写字母作为词的分隔，其他的字母均使用小写。
* 名字的首字母使用大写。
* 不要使用下划线（_）。


####2．类属性命名
* 属性命名应该以字符m为前缀。
* 前缀m后采用与类命名一致的规则。
* m总是在名字的开头起修饰作用，就像以r开头表示引用一样。

####3．方法命名
* 方法的作用都是执行一个动作，达到一个目的。所以名称应该说明方法是做什么。一般名称的前缀和后缀都有一定的规律，如：Is（判断）、Get（得到）、Set（设置）。
* 方法的命名规范和类命名是一致的。
如：
```php
    class StartStudy{                  //设置类
        $mLessonOne="";                //设置类属性
        $mLessonTwo="";                //设置类属性
        function GetLessonOne(){       //定义方法，得到属性mLessonOne的值
        …
        }
    }
```

####4．方法中参数命名
* 第一个字符使用小写字母。
* 在首字符后的所有字符都按照类命名规则首字符大写。

如以下代码：
```
    class EchoAnyWord{
        function EchoWord($firstWord，$secondWord){
        …
        }
    }
```

####5．变量命名
* 所有字母都使用小写。
* 使用“_”作为每个词的分界。



####6．引用变量
引用变量要带有r前缀。如：
```
    class Example{
        $mExam  ="";
        function SetExam(&$rExam){
            …
        }
        function&rGetExam(){
            …
        }
    }
```

####7．全局变量
* 全局变量应该带前缀g。

####8．常量/全局常量
* 常量/全局常量应该全部使用大写字母，单词之间用“_”来分隔。


####9．静态变量
* 静态变量应该带前缀s。

####10．函数命名
* 所有的名称都使用小写字母，多个单词使用“_”来分隔。


这里介绍的只是一些简单的书写和名称规则，如果想了解更多的编码规范，可以参考Zend_Framework中文参考手册。


---


#第4章 流程控制语句

##4.1　条件控制语句

###4.1.1　if语句

几乎所有的语言（包括PHP）都有if语句，它按照条件选择执行不同的代码片段。PHP的if语句的格式如下：
```
if (表达式)
	语句 ;
```
如果表达式的值为真，那么就顺序执行语句；否则，就会跳过该条语句，再往下执行。如果需要执行的语句不止一条，那么可以使用“{ }”，在“{ }”中的语句被称为语句组，其格式如下：
```
if(表达式){
	语句1;
	语句2;
	…
}
```

###4.1.2　if…else语句
大多时候，总是需要在满足某个条件时执行一条语句，而在不满足该条件时执行其他语句。这时可以使用else语句，该语句的格式如下：
```
if(表达式){
	语句1;
}else{
	语句2;
}
```
该语句的含义为：当表达式的值为真时，执行语句1；如果表达式的值为假，则执行语句2。


###4.1.3　else if语句
if…else语句只能选择两种结果：要么执行真，要么执行假。但有时会出现两种以上的选择，例如：一个班的考试成绩，如果是90分以上，则为“优秀”；如果是60～90分，则为“良好”；如果低于60分，则为“不及格”。这时可以使用elseif（也可以写作else if）语句来执行，该语句的格式如下：
```
if(表达式1){
	语句1;
}else if(表达式2){
	语句2;
}…
else{
	语句n;
}
```

###4.1.4　switch语句
虽然elseif语句可以进行多重选择，但使用时十分烦琐。为了避免if语句过于冗长，提高程序的可读性，可以使用switch分支控制语句。switch语句的语法格式如下：
```
switch(变量或表达式){
	case 常量表达式1:
		语句1;
		break;
	case 常量表达式2:
		…
	case 常量表达式n:
		语句n;
		break;
	default:
		语句n+1;
}
```
switch语句根据变量或表达式的值，依次与case中的常量表达式的值相比较，如果不相等，继续查找下一个case；如果相等，就执行对应的语句，直到switch语句结束或遇到break为止。
一般来说，switch语句最终都有一个默认值default，如果在前面的case中没有找到相符的条件，则输出默认语句，和else语句类似。


##4.2　循环控制语句

###4.2.1　while循环语句
While语句是PHP中最简单的循环语句，它的语法格式如下：
```
while (表达式){
	语句;
}
```
当表达式的值为真时，将执行循环体内的PHP语句，执行结束后，再返回到表达式继续进行判断。直到表达式的值为假才跳出循环，执行下面的语句。


###4.2.2　do…while循环语句
while语句还有另一种形式，即do…while。两者的区别在于，do…while要比while语句多循环一次。当while表达式的值为假时，while循环直接跳出当前循环；而do…while语句则是先执行一遍程序块，然后再对表达式进行判断。

它的语法格式如下：
```
do{
	语句;
}
while (表达式)
```

###4.2.3　for循环语句
for循环是PHP中最复杂的循环结构，它的语法格式如下：
```
for(初始化表达式; 条件表达式; 迭代表达式){
	语句;
}
```
其中，初始化表达式在第一次循环时无条件取一次值；条件表达式在每次循环开始前求值，如果值为真，则执行循环体里面的语句，否则跳出循环，继续往下执行；迭代表达式在每次循环后被执行。
在for语句中无论采用循环变量递增或递减的方式，前提是一定要保证循环能够结束，无期限的循环（死循环）将导致程序的崩溃。


###4.2.4　foreach循环语句
foreach循环是PHP 4引进来的，只能用于数组。在PHP 5中，又增加了对对象的支持。该语句的语法格式如下：
`foreach ($array as $value)	语句;`或 `foreach ($array as $key => $value)	语句;`
foreach语句将遍历数组$array，每次循环时，将当前数组中的值赋给$value（或$key和$value），同时，数组指针向后移动直到遍历结束。当使用foreach语句时，数组指针将自动被重置，所以不需要手动设置指针位置。


##4.3　跳转语句

###4.3.1　break语句
break关键字可以终止当前的循环，包括while、do…while、for、foreach和switch在内的所有控制语句。

break语句不仅可以跳出当前的循环，还可以指定跳出几重循环。格式如下：`break $num;`
其中，$num指定要跳出几层循环。


###4.3.2　continue语句
continue关键字的作用没有break强大，它只能终止本次循环而进入到下一次循环中，也可以指定跳出几重循环。


---


#第5章 字符串操作

##5.1　字符串的定义方法

###5.1.1　使用单引号或双引号定义字符串
字符串通常以串的整体作为操作对象，一般用双引号或者单引号标识一个字符串。单引号和双引号在使用上有一定区别。
单引号串和双引号串在PHP中的处理是不相同的。双引号串中的内容可以被解释而且替换，而单引号串中的内容被作为普通字符进行处理。


###5.1.2　使用定界符定义字符串
定界符（<<<）是从PHP 4.0开始支持的。定界符用于定义格式化的大文本，格式化是指文本中的格式将被保留，所以文本中不需要使用转义字符。在使用时后接一个标识符，然后是格式化文本（即字符串），最后是同样的标识符结束字符串。
定界符格式如下：
```
<<<str
	格式化文本
str
```
其中，符号“<<<”是关键字，必须使用；str为用户自定义的标识符，用于定义文本的起始标识符和结束标识符，前后的标识符名称必须完全相同。
结束标识符必须从行的第一列开始，而且也必须遵循PHP中其他任何标签的命名规则：只能包含字母、数字、下划线，而且必须以下划线或非数字字符开始。
定界符中的字符串支持单引号、双引号，无须转义，并支持字符变量替换。


##5.2　字符串操作

###5.2.1　去除字符串首尾空格和特殊字符
用户在输入数据时，经常会在无意中输入多余的空格，有些情况下，字符串中不允许出现空格和特殊字符，此时就需要去除字符串中的空格和特殊字符。
在PHP中提供了trim()函数去除字符串左右两边的空格和特殊字符，ltrim()函数去除字符串左边的空格和特殊字符，rtrim()函数去除字符串中右边的空格和特殊字符。

####1．trim()函数
trim()函数用于去除字符串首尾处的空白字符（或者其他字符）。
语法格式如下：`string trim(string str[,string charlist]);`
其中，str是要操作的字符串对象；charlist为可选参数，一般要列出所有希望过滤的字符，也可以使用“..”列出一个字符范围。如果不设置该参数，则所有的可选字符都将被删除。

####2．Itrim()函数
ltrim()函数用于去除字符串左边的空格或者指定字符串。
语法格式如下：`string ltrim(string str[,string charlist]);`

####3．rtrim()函数
rtrim()函数用于去除字符串右边的空格或者指定字符串。
语法格式如下：`string rtrim(string str[,string charlist]);`


###5.2.2　转义、还原字符串数据
字符串转义、还原的方法有两种：一种是手动转义、还原字符串数据，另一种是自动转义、还原字符串数据。下面分别对这两种方法进行详细讲解。

####1．手动转义、还原字符串数据
字符串可以用单引号（'）、双引号（"）、定界符（<<<）3种方法定义，而指定一个简单字符串的最简单的方法是用单引号括起来。当使用字符串时，很可能在该串中存在这几种符号与PHP脚本混淆的字符，因此必须要做转义语句。这就要在它的前面使用转义符号“\”。
“\”是一个转义符，紧跟在“\”后面的第一个字符将变得没有意义或有特殊意义。如“'”是用来定义字符串，但写为“\'”时就失去了定义字符串的意义，变为普通的单引号。读者可以通过“echo '\'';”输出一个单引号，同时转义字符“\”不会显示。
如果要在字符串中表示单引号，则需要用反斜线（\）进行转义。例如，要表示字符串“I'm”，则需要写成“I\'m”。

`对于简单的字符串建议采用手动方法进行字符串转义，而对于数据量较大的字符串，建议采用自动转义函数实现字符串的转义。`

####2．自动转义、还原字符串数据
自动转义、还原字符串数据可以应用PHP提供的addslashes()函数和stripslashes()函数实现。

#####addslashes()函数
addslashes()函数的作用是使用反斜线引用字符串。
语法格式如下：`string addslashes(string str)`,其中，str为要转义的字符串。
返回值：返回转义后的字符。
返回字符串中，为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（'）、双引号（"）、反斜线（\）与NUL（NULL字符）。

#####stripslashes()函数
stripslashes()函数的作用是反引用一个引用字符串。
语法格式如下：`string stripslashes(string str);`,其中，str为输入字符串。
返回值：返回一个去除转义反斜线后的字符串（“\'”转换为“'”等）。双反斜线（\\）被转换为单个反斜线（\）。

所有数据在插入数据库之前，有必要应用addslashes()函数进行字符串转义，以免特殊字符未经转义在插入数据库时出现错误。另外，对于使用addslashes()函数实现的自动转义字符串可以使用stripslashes()函数进行还原，但数据在插入数据库之前必须再次进行转义。

以上两个函数实现了对指定字符串进行自动转义和还原。除了上面介绍的方法外，还可以对要转义、还原的字符串进行一定范围的限制，通过使用addcslashes()函数和stripcslashes()函数实现对指定范围内的字符串进行自动转义、还原。
下面分别对这两个函数进行详细介绍。

#####addcslashes()函数
实现转义字符串中的字符，即在指定的字符charlist前加上反斜线。
语法格式如下：`string addcslashes(string str, string charlist)`
其中，str为将要被操作的字符串；charlist指定在字符串中的哪些字符前加上反斜线，如果参数charlist中包含\n、\r等字符，将以C语言风格转换，而其他非字母数字且ASCII码低于32以及高于126的字符均转换成八进制表示。
在定义参数charlist的范围时，需要明确在开始和结束的范围内的字符。

#####stripcslashes()函数
stripcslashes()函数用来将应用addcslashes()函数转义的字符串str还原。
语法格式如下：`string stripcslashes(string str)`


###5.2.3　获取字符串的长度
获取字符串的长度使用的是strlen()函数，下面重点讲解该函数的语法及其应用。
strlen()函数主要用于获取指定字符串str的长度。
语法格式如下：`int strlen(string str)`
strlen()函数在获取字符串长度的同时，也可以用来检测字符串的长度。

###5.2.4　截取字符串
在PHP中有一项非常重要的技术，就是截取指定字符串中指定长度的字符。PHP对字符串截取可以采用预定义函数substr()实现。本节重点介绍字符串的截取技术。
语法格式如下：`string substr( string str, int start[, int length])`
substr()函数的参数说明如下:
参数|说明
---|---
str|指定字符串对象
start|指定开始截取字符串的位置。如果参数start为负数，则从字符串的末尾开始截取
length|可选参数，指定截取字符的个数，如果length为负数，则表示取到倒数第length个字符

substr()函数中参数start的指定位置是从0开始计算的，即字符串中的第一个字符表示为0。

在开发Web程序时，为了保持整个页面的合理布局，经常需要对一些超长文本进行部分显示。
实现方式:从指定的字符串中按照指定的位置截取一定长度的字符。通过substr()函数可以获取某个固定格式字符串中的一部分。


###5.2.5　比较字符串
在PHP中，对字符串之间进行比较的方法主要有3种，第一种是使用strcmp()函数按照字节进行比较，第二种是使用strnatcmp()函数按照自然排序法进行比较，第三种是使用strncmp()函数指定从源字符串的位置开始比较。下面分别对这3种方法进行详细讲解。

####1．按字节进行字符串的比较
按字节进行字符串比较的方法有两种，分别是strcmp()和strcasecmp()函数，通过这两个函数即可实现对字符串进行按字节的比较。这两种函数的区别是strcmp()函数区分字符的大小写，而strcasecmp()函数不区分字符的大小写。由于这两个函数的实现方法基本相同，这里只介绍strcmp()函数。

strcmp()函数用来对两个字符串进行比较。
语法格式如下：`int strcmp(string str1, string str2)`
其中，str1和str2指定要比较的两个字符串。如果str1和str2相等，则返回0；如果str1大于str2，则返回值大于0；如果str1小于str2，则返回值小于0。
strcmp()函数区分字母大小写。
在PHP中，对字符串之间进行比较的应用也是非常广泛的。例如，使用strcmp()函数比较在用户登录系统中输入的用户名和密码是否正确。如果在验证用户名和密码时不使用此函数，那么输入的用户名和密码无论是大写还是小写，只要正确即可登录。使用strcmp()函数可避免这种情况，即使正确，也必须大小写匹配才可以登录，从而提高了网站的安全性。

####2．按自然排序法进行字符串的比较
在PHP中，按照自然排序法进行字符串的比较是通过strnatcmp()函数来实现的。将字符串中的字符按照从左到右的顺序进行比较。如果是数字与数字比较，则按照自然排序法，其他情况则根据字符的ASCII码值进行比较。
语法格式如下：`int strnatcmp(string str1, string str2)`
如果字符串str1和str2相等，则返回0；如果str1大于str2，则返回值大于0；如果str1小于str2，则返回值小于0。Strnatcmp()函数区分字母大小写。
按照自然运算法进行比较，还可以使用另一个与strnatcmp()函数作用相同，但不区分大小写的strnatcasecmp()函数。

####3．指定从源字符串的位置开始比较
strncmp()函数用来比较字符串中的前n个字符。
语法格式如下：`int strncmp(string str1,string str2,int len)`
如果字符串str1和str2相等，则返回0；如果str1大于str2，则返回值大于0；如果str1小于str2，则返回值小于0。Strncmp()函数区分字母大小写。
strncmp()函数的参数如下:
参数|说明
---|---
str1|指定参与比较的第一个字符串对象
str2|指定参与比较的第二个字符串对象
len|必要参数，指定每个字符串中参与比较字符的数量


###5.2.6　检索字符串
在PHP中，提供了很多应用于字符串查找的函数，可以像Word那样实现对字符串的查找功能。下面讲解常用的字符串检索技术。

####1．使用strstr()函数查找指定的关键字
strstr()函数用于获取一个指定字符串在另一个字符串中首次出现的位置到后者末尾的子字符串。如果执行成功，则返回剩余字符串（存在相匹配的字符）；如果没有找到相匹配的字符，则返回false。
语法格式如下：`string strstr(string haystack, string needle)`
strstr()函数的参数说明如下:
参数|说明
---|---
haystack|必要参数，指定从哪个字符串中进行搜索
needle|必要参数，指定搜索的对象。如果该参数是一个数值，那么将搜索与这个数值的ASCII值相匹配的字符

strstr()函数区分字母的大小写。
strrchr()函数与其正好相反，该函数是从字符串后序的位置开始检索子串（子字符串）的。

####2．使用substr_count()函数检索子串出现的次数
substr_count()函数用于获取指定字符在字符串中出现的次数。
语法格式如下：`int substr_count(string haystack,string needle)`
其中，haystack是指定的字符串，needle为指定的字符。


###5.2.7　替换字符串
通过字符串的替换技术可以实现对指定字符串中的指定字符进行替换。字符串的替换技术可以通过以下两个函数实现：str_ireplace()函数和substr_replace()函数。

####1．str_ireplace()函数
使用新的子字符串（子串）替换原始字符串中被指定要替换的字符串。
语法格式如下：`mixed str_ireplace(mixed search, mixed replace, mixed subject[, int &count])`
将所有在参数subject中出现的参数search以参数replace取代，参数&count表示取代字符串执行的次数。str_ireplace()函数区分大小写。

str_ireplace()函数的参数如下

str_treplace()函数在执行替换的操作时不区分大小写，如果需要对大小写加以区分，可以使用str_replace()函数。

字符串替换技术最常用的就是在搜索引擎的关键字处理中，可以使用字符串替换技术将搜索到的字符串中的关键字替换颜色，如查询关键字描红功能，使搜索到的结果更便于用户查看。

查询关键字描红是指将查询关键字以特殊的颜色、字号或字体进行标识。这样可以使浏览者快速检索到所需的关键字，方便浏览者从搜索结果中查找所需内容。查询关键字描红适用于模糊查询。

####2．substr_replace()函数
substr_replace()函数用于对指定字符串中的部分字符串进行替换。
语法格式如下：`mixed substr_replace(mixed string,mixed repl,mixed start,[mixed length])`
substr_replace()函数的参数说明如下


如果参数start设置为负数，而参数length数值小于或等于start数值，那么length的值自动为0。


###5.2.8　格式化字符串
在PHP中，字符串的格式化方式有多种，按照格式化的类型可以分为字符串的格式化和数字的格式化，数字的格式化最为常用，本节将重点讲解数字格式化函数number_format()。

number_format()函数用来将数字字符串格式化。
语法格式如下：`string number_format(float number[,int decimals [,string dec_point[,string thousands_sep]]])`
其中，number为要格式化的数字，decimals为要保留的小数位数，dec_point为指定小数点显示的字符，thousands_sep为指定千位分隔符显示的字符。
number_format()函数可以有1个、2个或是4个参数，但不能是3个参数。如果只有1个参数number，number的小数部分会被去掉，并且每个千位分隔符都是用英文小写逗号“，”来隔开；如果有2个参数，number将保留小数点后的位数到设定的值，且每一千就会以逗号来隔开；如果有4个参数，number将保留decimals个长度的小数部分，小数点被替换为dec_point，千位分隔符替换为thousands_sep。


###5.2.9　分割、合成字符串
####1．分割字符串
字符串的分割是通过explode()函数实现的。explode()函数按照指定的规则对一个字符串进行分割，返回值为数组。
语法格式如下：`array explode(string delimiter,string str[,int limit])`
explode()函数的参数说明如下
参数|说明
---|---
delimiter|边界上的分隔字符
str|必要参数，指定将要被分割的字符串
limit|可选参数，如果设置了limit参数，则返回的数组包含最多limit个元素，而最后的元素将包含str的剩余部分；如果limit参数是负数，则返回除了最后的-limit个元素外的所有元素。如果limit是0，则会当作1

####2．合成字符串
implode()函数可以将数组的内容组合成一个新字符串。
语法格式如下：`string implode(string glue, array pieces)`
其中，glue是字符串类型，指定分隔符；pieces是数组类型，指定要被合并的数组。

implode()函数和explode()函数是两个相对的函数，一个用于合成，另一个用于分割。


---

#第6章 正则表达式

##6.1　什么是正则表达式
正则表达式是一种描述字符串结构的语法规则，是一个特定的格式化模式，可以匹配、替换、截取匹配的字串。


##6.2　正则表达式语法规则
一个完整的正则表达式由两部分构成，元字符和文本字符。元字符就是具有特殊含义的字符，文本字符就是普通的文本，


###6.2.1　行定位符（^和$）
行定位符就是用来描述字串的边界。“^”表示行的开始；“$”表示行的结尾

###6.2.2　单词分界符（\b、\B）
使用单词分界符“\b”，表示要查找的字串为一个完整的单词。
大写的“\B”，意思和“\b”相反，它匹配的字串不能是一个完整的单词，而是其他单词或字串的一部分。


###6.2.3　字符类（［］）
正则表达式是区分大小写的，如果要忽略大小写可使用方括号表达式“[]”。只要匹配的字符出现在方括号内，即可表示匹配成功。但要注意：一个方括号只能匹配一个字符。


###6.2.4　选择字符（|）
该字符可以理解为“或”

使用“[]”和使用“|”的区别在于，“[]”只能匹配单个字符，而“|”可以匹配任意长度的字串。

###6.2.5　连字符（-）
连字符可以表示字符的范围。


###6.2.6　排除字符（[^]）
放到方括号中，表示排除的意思。


###6.2.7　限定符（? ＊ + {n,m}）
？匹配前面的字符零次或者一次
+ 匹配前面的字符一次或多次
* 匹配前面的字符零次或多次
{n} 匹配前面的字符n次
{n, } 匹配前面的字符最少n次
{n,m} 匹配前面的字符最少n次，最多每次


###6.2.8　点号字符（.）
点号字符（.）可以匹配出换行符外的任意一个字符。注意：是除了换行符外的、任意的一个字符。


###6.2.9　转义字符（\）
表达式中的转义字符（\）和PHP中的大同小异，都是将特殊字符（如“.”“?”“\”等）变为普通的字符。


###6.2.10　反斜线（\）
除了可以做转义字符外，反斜线还有其他一些功能。
* 反斜线可以将一些不可打印的字符显示出来
* 可以指定预定义字符集
* 定义断言，其中已经了解过了“\b”“\B”


###6.2.11　括号字符（()）
第一个作用就是可以改变限定符的作用范围，如“|”“*”“^”等
第二个作用是分组，也就是子表达式。


###6.2.12　反向引用
反向引用，就是依靠子表达式的“记忆”功能来匹配连续出现的字串或字母。

如匹配连续两个it，首先将单词it作为分组，然后在后面加上“\1”即可。格式为：`(it)\1`
这就是反向引用最简单的格式。如果要匹配的字串不固定，那么就将括号内的字串写成一个正则表达式。如果使用了多个分组，那么可以用“\1”“\2”来表示每个分组（顺序是从左到右）。如：`([a-z])([A-Z])\1\2`
除了可以使用数字来表示分组外，还可以自己来指定分组名称。语法格式如下：`(?P<subname>…)`
如果想要反向引用该分组，使用如下语法：`(?P=subname)`

下面来重写一下表达式([a-z])([A-Z])\1\2。为这两个分组分别命名，并反向引用它们。
正则表达式如下：`(?P<fir>[a-z])(?P<sec>[A-Z])(?P=fir)(?P=sec)`


###6.2.13　模式修饰符
模式修饰符的作用是设定模式，也就是规定正则表达式应该如何解释和应用。
不同的语言都有自己的模式设置，PHP中的主要模式如下:
I：忽略大小写模式
M：多文本模式，即字串内部有多个换行符时i，影响^和$匹配
s：单文本模式，在此模式下，元字符.可以匹配换行符
x：忽略空白字符


#6.3　PCRE兼容正则表达式函数
PHP中提供了两套支持正则表达式的函数库，但是由于PCRE函数库在执行效率上要略优于POSIX函数库，所以这里只讲解PCRE函数库中的函数。实现PCRE风格的正则表达式的函数有7个，下面就来了解一下这7个PCRE函数。


###6.3.1　preg_grep()函数
函数语法：`array preg_grep (string pattern, array input)`
函数功能：使用数组input中的元素一一匹配表达式pattern，最后返回由所有相匹配的元素所组成的数组。


###6.3.2　preg_match()和preg_match_all()函数
函数语法：`int preg_match/preg_match_all (string pattern, string subject [, array matches])`
函数功能：在字符串subject中匹配表达式pattern。函数返回匹配的次数。如果有数组matches，那么每次匹配的结果都将被存储到数组matches中。
函数preg_match()的返回值是0或1。因为该函数在匹配成功后就停止继续查找了。而preg_match_all()函数则会一直匹配到最后才会停止。参数array matches对于preg_match_all()函数是必须有的，而对前者则可以省略。


###6.3.3　preg_quote()函数
函数语法：`string preg_quote (string str [, string delimiter])`
函数功能：该函数将字符串str中的所有特殊字符进行自动转义。如果有参数delimiter，那么该参数所包含的字串也将被转义。函数返回转义后的字串。


###6.3.4　preg_replace()函数
函数语法：`mixed preg_replace (mixed pattern, mixed replacement, mixed subject [, int limit])`
函数功能：该函数在字符串subject中匹配表达式pattern，并将匹配项替换成字串replacement。如果有参数limit，则替换limit次。
如果参数中调用的是数组，有可能在调用过程中并不是按照数组的key值进行替换，所以在调用之前需要使用ksort()函数对数组重新排列。


###6.3.5　preg_replace_callback()函数
函数语法：`mixed preg_replace_callback (mixed pattern, callback callback, mixed subject [, int limit])`
preg_replace_callback()函数与preg_replace()函数的功能相同，都用于查找和替换字串。不同的是，preg_replace_callback()函数使用一个回调函数（callback）来代替replacement参数。
在preg_replace_callback()函数的回调函数中，字符串使用“''”，这样可以保证字符串中的特殊符号不被转义。


###6.3.6　preg_split()函数
函数语法：`array preg_split (string pattern, string subject [, int limit ])`
函数功能：使用表达式pattern来分割字符串subject。如果有参数limit，那么数组最多有limit个元素。该函数与ereg_split()函数的使用方法相同。


##6.4　应用正则表达式对用户注册信息进行验证


##6.5　小结


##6.6　实践与练习


---

#第7章 PHP数组
数组是对大量数据进行有效组织和管理的手段之一，通过数组的强大功能，可以对大量性质相同的数据进行存储、排序、插入及删除等操作，从而可以有效地提高程序开发效率及改善程序的编写方式。PHP作为市面上最为流行的Web开发语言之一，凭借其代码开源、升级速度快等特点，对数组的操作能力更为强大，尤其是PHP为程序开发人员提供了大量方便、易懂的数组操作函数，更使PHP深受广大Web开发人员的青睐。


##7.1　什么是数组
数组就是一组数据的集合，把一系列数据组织起来，形成一个可操作的整体。PHP中的数组较为复杂，但比其他许多高级语言中的数组更灵活。数组array是一组有序的变量，其中每个变量被称为一个元素。每个元素由一个特殊的标识符来区分，这个标识符称为键（也称为下标）。数组中的每个实体都包含两项：键和值。可以通过键值来获取相应数组元素，这些键可以是数值键或关联键。如果说变量是存储单个值的容器，那么数组就是存储多个值的容器。


##7.2　声明数组
在PHP中声明数组的方式主要有两种：一种是应用array()函数声明数组，另一种是直接通过为数组元素赋值的方式声明数组。其中，应用array()函数声明数组的方式如下：`array array ([mixed ...])`
其中，mixed的语法为key=> value，多个参数mixed间用逗号分开，分别定义了索引和值。索引可以是字符串或数字。如果省略了索引，则会自动产生从0开始的整数索引。如果索引是整数，则下一个产生的索引将是目前最大的整数索引加1。如果定义了两个完全一样的索引，则后面一个会覆盖前一个。数组中的各数据元素的数据类型可以不同，也可以是数组类型。当mixed是数组类型时，就是二维数组。
应用array()函数声明数组时，数组下标既可以是数值索引，也可以是关联索引。下标与数组元素值之间用“=>”进行连接，不同数组元素之间用逗号进行分隔。
应用array()函数定义数组比较灵活，可以在函数体中只给出数组元素值，而不必给出键值。
可以通过给变量赋予一个没有参数的array()函数来创建空数组，然后使用方括号语法来添加值。
PHP提供创建数组的array()语言结构。在使用其中的数据时，可以直接利用它们在数组中的排列顺序取值，这个顺序称为数组的下标。
PHP中另一种比较灵活的数组声明方式是直接为数组元素赋值。如果在创建数组时不知道所创建数组的大小，或在实际编写程序时数组的大小可能发生改变，采用这种数组创建的方法较好。


##7.3　数组的类型
PHP支持两种数组：索引数组（indexed array）和联合数组（associative array），前者使用数字作为键，后者使用字符串作为键。


###7.3.1　数字索引数组
PHP数字索引一般表示数组元素在数组中的位置，它由数字组成，下标从0开始，数字索引数组默认索引值从数字0开始，不需要特别指定，PHP会自动为索引数组的键名赋一个整数值，然后从这个值开始自动增量，当然，也可以指定从某个位置开始保存数据。

数组可以构造成一系列键-值（key-value）对，其中每一对都是数组的一个项目或元素（element）。对于列表中的每个项目，都有一个与之关联的键（key）或索引


###7.3.2　关联数组
关联数组的键名可以是数值和字符串混合的形式，而不像数字索引数组的键名只能为数字。在一个数组中，只要键名中有一个不是数字，那么这个数组就称为关联数组。

关联数组（associative array）使用字符串索引（或键）来访问存储在数组中的值

`关联数组的键名可以是任何一个整数或字符串。如果键名是一个字符串，则不要忘了给这个键名或索引加上一个定界修饰符——单引号（'）或双引号（"）。对于数字索引数组，为了避免不必要的麻烦，最好也加上定界符。`


##7.4　输出数组
在PHP中对数组元素进行输出，可以通过输出语句来实现，如echo、print语句等，但使用这种输出方式只能对数组中某一元素进行输出，而通过print_r()函数可以将数组结构进行输出。
语法格式如下：`bool print_r ( mixed expression )`
如果该函数的参数expression为普通的整型、字符型或实型变量，则输出该变量本身。如果该参数为数组，则按一定键值和元素的顺序显示出该数组中的所有元素。


##7.5　数组的构造

###7.5.1　一维数组
当一个数组的元素是变量时，称这个数组为一维数组。一维数组是最普通的数组，它只保存一列内容。
声明一维数组的一般形式是：
类型说明符 数组名 常量表达式;


###7.5.2　二维数组
如果一个数组的元素是一维数组，则称这个数组是二维数组。


##7.6　遍历数组
遍历数组中的所有元素是常用的一种操作，在遍历的过程中可以完成查询等功能
在PHP中遍历数组的方法有多种，下面介绍最常用的两种方法。

1．使用foreach结构遍历数组
遍历数组元素最常用的一种方法是使用foreach结构。foreach结构并非操作数组本身，而是操作数组的一个备份。

2．使用list()函数遍历数组
把数组中的值赋给一些变量。与array()函数类似，这不是真正的函数，而是语言结构。list()函数仅能用于数字索引的数组，且数字索引从0开始。


#7.7　字符串与数组的转换
###7.7.1．使用explode()函数将字符串转换成数组
explode()函数将字符串依指定的字符串或字符separator切开。
语法格式如下：`array explode(string separator, string string, [int limit])`
返回由字符串组成的数组，每个元素都是string的一个子串，它们被字符串separator作为边界点分隔出来。如果设置了limit参数，则返回的数组包含最多limit个元素，而最后那个元素将包含string的剩余部分；如果separator为空字符串（""），explode()函数将返回false；如果separator所包含的值在string中找不到，那么explode()函数将返回包含string单个元素的数组；如果参数limit是负数，则返回除了最后的-limit个元素外的所有元素。


###7.7.2．使用implode()函数将数组转换成一个新字符串
implode()函数用于将数组的内容组合成一个字符串。
语法格式如下：`string implode(string glue, array pieces)`
其中，glue是字符串类型，指要传入的分隔符；pieces是数组类型，指传入的要合并元素的数组变量名称。


##7.8　统计数组元素个数
在PHP中，使用count()函数对数组中的元素个数进行统计。
语法格式如下：`int count(mixed array[, int mode])`
count()函数的参数说明如表:
参数|说明
---|---
array|必要参数。输入的数组
mode|可选参数。COUNT_RECURSIVE（或1），如选中此参数，本函数将递归地对数组计数。对计算多维数组的所有单元尤其有用。此参数的默认值为0


##7.9　查询数组中指定元素
array_search()函数用于在数组中搜索给定的值，找到后返回键名，否则返回false。`在PHP 4.2.0之前，函数在失败时返回null而不是false。`
语法格式如下：`mixed array_search(mixed needle, array haystack [, bool strict])`
其中，needle指定在数组中搜索的值；haystack指定被搜索的数组；strict为可选参数，如果值为true，还将在数组中检查给定值的类型。


##7.10　获取数组中最后一个元素
array_pop()函数获取并返回数组的最后一个元素，并将数组的长度减1，如果数组为空（或者不是数组）将返回null。
语法格式如下：`mixed array_pop(array array)`
其中，array为输入的数组。


##7.11　向数组中添加元素
array_push()函数将数组当成一个栈，将传入的变量压入该数组的末尾，该数组的长度将增加入栈变量的数目，返回数组新的元素总数。
语法格式如下：`int array_push(array array, mixed var [, mixed ...])`
其中，array为指定的数组，var是压入数组中的值。


##7.12　删除数组中重复元素
array_unique()函数用于将值作为字符串排序，然后对每个值只保留第一个键名，忽略所有后面的键名，即删除数组中重复的元素。
语法格式如下：`array array_unique(array array)`
其中，array为输入的数组。


##7.13　综合运用数组函数实现多文件上传


##7.14　小结


##7.15　实践与练习


---

#第8章 PHP与Web页面交互

##8.1　表单

###8.1.1　创建表单
使用<form>标记，并在其中插入相关的表单元素，即可创建一个表单。
表单结构：
<form name="form_name"  method="method"action="url"  enctype="value"  target="target_win">
    …                          //省略插入的表单元素
</form >

<form>标记的属性如下
属性|说明
---|---
name|表单名称
method|设置表单的提交方式，GET或者POST方法
action|指向处理该表页面的url
enctype|设置表单内容的格式
target|设置返回信息的显示格式

target属性值
属性值|描述
---|---
_blank|将返回信息显示在新窗口中
_parent|将返回信息显示在父级窗口中
_self|将返回信息显示在当前窗口中
_top|将返回信息显示在顶级窗口中


###8.1.2　表单元素
1．输入域标记<input>
输入域标记<input>是表单中最常用的标记之一。常用的文本框、按钮、单选按钮、复选框等构成了一个完整的表单。
语法格式如下：
<form>
    <input name="file_name"  type="type_name">
</form>
其中，name是指输入域的名称，type是指输入域的类型。在<input type="">标记中一共提供了10种类型的输入区域，用户所选择使用的类型由type属性决定。


2．选择域标记<select>和<option>
通过选择域标记<select>和<option>可以建立一个列表或者菜单。菜单的使用是为了节省空间，正常状态下只能看到一个选项，单击右侧的下三角按钮打开菜单后才能看到全部的选项。列表可以显示一定数量的选项，如果超出了这个数量，会自动出现滚动条，浏览者可以通过拖动滚动条来查看各选项。
语法格式如下：
<select name="name" size="value" multiple>
    <option value="value" selected>选项1</option>
    <option value="value">选项2</option>
    <option value="value">选项3</option>
    …
</select>
其中，name表示选择域的名称；size表示列表的行数；value表示菜单选项值；multiple表示以菜单方式显示数据，省略则以列表方式显示数据。


3．文字域标记<textarea>
文字域标记<textarea>用来制作多行的文字域，可以在其中输入更多的文本。
语法格式如下：
<textarea name="name" rows=value cols=value value="value" warp="value">
    …//文本内容
</textarea>
其中，name表示文字域的名称；rows表示文字域的行数；cols表示文字域的列数（这里的rows和cols以字符为单位）；value表示文字域的默认值；warp用于设定显示和送出时的换行方式，值为off表示不自动换行，值为hard表示自动硬回车换行，换行标记一同被发送到服务器，输出时也会换行，值为soft表示自动软回车换行，换行标记不会被发送到服务器，输出时仍然为一列。


##8.2　在普通的Web页中插入表单


##8.3　获取表单数据的两种方法

###8.3.1　使用POST方法提交表单
应用POST方法时，只需将form表单中的属性method设置成POST即可。POST方法不依赖于URL，不会显示在地址栏。POST方法可以没有限制地传递数据到服务器，所有提交的信息在后台传输，用户在浏览器端是看不到这一过程的，安全性高。所以POST方法比较适合用于发送一个保密的（如信用卡号）或者容量较大的数据到服务器。


###8.3.2　使用GET方法提交表单
GET方法是form表单中method属性的默认方法。使用GET方法提交的表单数据被附加到URL后，并作为URL的一部分发送到服务器端。在程序的开发过程中，由于GET方法提交的数据是附加到URL上发送的，因此，在URL的地址栏中将会显示“URL+用户传递的参数”。
`若要使用GET方法发送表单，URL的长度应限制在1MB字符以内。如果发送的数据量太大，数据将被截断，从而导致意外或失败的处理结果。`
这种方法会将参数暴露。如果用户传递的参数是非保密性的参数（如id=8），那么采用GET方法传递数据是可行的，如果用户传递的是保密性的参数（如密码），这种方法就会不安全。解决该问题的方法是将表单的method属性指定的GET方法改为POST方法。


##8.4　PHP参数传递的常用方法
PHP参数传递常用的方法有3种：$_POST[]、$_GET[]、$_SESSION[]，分别用于获取表单、URL与Session变量的值。


###8.4.1　$_POST[]全局变量
使用PHP的$_POST[]预定义变量可以获取表单元素的值，格式为：`$_POST[name]`

在某些PHP版本中直接写$user即可调用表单元素的值，这和php.ini的配置有关系。在php.ini文件中检索到register_globals=ON/OFF这行代码，如果为ON，就可以直接写成$user，反之则不可以。虽然直接应用表单名称十分方便，但也存在一定的安全隐患。此处推荐使用register globals=OFF。


###8.4.2　$_GET[]全局变量
PHP使用$_GET[]预定义变量获取通过GET方法传过来的值，使用格式为：`$_GET[name]`

PHP可以应用$_POST[]或$_GET[]全局变量来获取表单元素的值。但值得注意的是，获取的表单元素名称区别字母大小写。如果读者在编写Web程序时疏忽了字母大小写，那么在程序运行时将获取不到表单元素的值或弹出错误提示信息。


###8.4.3　$_SESSION[]变量
使用$_SESSION[]变量可以获取表单元素的值，格式为：`$_SESSION[name]`

使用$_SESSION[]传参的方法获取的变量值，保存之后任何页面都可以使用。但这种方法很耗费系统资源，建议读者慎重使用。关于$_SESSION变量将在第11章进行详细讲解。


##8.5　在Web页中嵌入PHP脚本
在Web页中嵌入PHP脚本的方法有两种，一种是直接在HTML标记中添加PHP标记符<?php ?>，写入PHP脚本，另一种是对表单元素的value属性进行赋值。


###8.5.1　在HTML标记中添加PHP脚本
在Web编码过程中，可以随时添加PHP脚本标记<?php ?>，两个标记之间的所有文本都会被解释成PHP，而标记之外的任何文本都会被认为是普通的HTML。


###8.5.2　对表单元素的value属性进行赋值
在Web程序开发过程中，通常需要对表单元素的value属性进行赋值，以获取该表单元素的默认值。



##8.6　在PHP中获取表单数据

###8.6.1　获取文本框、密码域、隐藏域、按钮、文本域的值
获取表单数据，实际上就是获取不同的表单元素的数据。<form>标签中的name是所有表单元素都具备的属性，即为这个表单元素的名称，在使用时需要使用name属性来获取相应的value属性值。所以，添加的所有控件必须定义对应的name属性值，另外，控件在命名上尽可能不要重复，以免获取的数据出错。

在程序开发过程中，获取文本框、密码域、隐藏域、按钮以及文本域的值的方法是相同的，都是使用name属性来获取相应的value属性值。


###8.6.2　获取单选按钮的值
radio（单选按钮）一般是成组出现的，具有相同的name值和不同的value值，在一组单选按钮中，同一时间只能有一个被选中。


###8.6.3　获取复选框的值
复选框一般都是多个同时存在，为了便于传值，name的名字可以是一个数组形式，格式为：
`<input type="checkbox" name="chkbox[]" value="chkbox1">`
在返回页面可以使用count()函数计算数组的大小，结合for循环语句输出选择的复选框的值。


###8.6.4　获取下拉列表框/菜单列表框的值
列表框有下拉列表框和菜单列表框两种形式，它们基本的语法都一样。在进行网站程序设计时，下拉列表框和菜单列表框的应用非常广泛。可以通过下拉列表框和菜单列表框实现对条件的选择。

1．获取下拉列表框的值
获取下拉列表框的值的方法非常简单，与获取文本框的值类似，首先需要定义下拉列表框的name属性值，然后应用$_POST[]全局变量进行获取。

2．获取菜单列表框的值
当<select>标记设置了multiple属性，则为菜单列表框，可以选择多个条件。由于菜单列表框一般都是多个值同时存在，为了便于传值，<select>标记的命名通常采用数组形式，格式为：
`<input type="checkbox" name="chkbox[]" multiple>`
在返回页面可以使用count()函数计算数组的大小，结合for循环语句输出选择的菜单项。


###8.6.5　获取文件域的值
文件域的作用是实现文件或图片的上传。文件域有一个特有的属性accept，用于指定上传的文件类型，如果需要限制上传文件的类型，则可以通过设置该属性完成。


##8.7　对URL传递的参数进行编/解码

###8.7.1　对URL传递的参数进行编码
URL编码是一种浏览器用来打包表单输入数据的格式，是对用地址栏传递参数进行的一种编码规则。如在参数中带有空格，则传递参数时就会发生错误，而用URL编码后，空格转换成“%20”，这样错误就不会发生了，对中文进行编码也是同样的情况，最主要的一点就是对传递的参数起到了隐藏的作用。
在PHP中对查询字符串进行URL编码，可以通过urlencode()函数实现，该函数的语法如下：
`string urlencode(string str)`
urlencode()函数实现对字符串str进行URL编码。

对于服务器而言，编码前后的字符串并没有什么区别，服务器能够自动识别。这里主要是为了讲解URL编码的使用方法。在实际应用中，对一些非保密性的参数不需要进行编码，读者可根据实际情况有选择地使用。


###8.7.2　对URL传递的参数进行解码
对于URL传递的参数直接使用$_GET[]方法即可获取。而对于进行URL加密的查询字符串，则需要通过urldecode()函数对获取后的字符串进行解码，该函数的语法如下：
`string urldecode(string str)`
urldecode()函数可将URL编码后的str查询字符串进行解码。


##8.8　PHP与Web表单的综合应用

##8.9　小结

##8.10　实践与练习


---


#第9章 PHP与JavaScript交互


##9.1　了解JavaScript
JavaScript是脚本编程语言，支持Web应用程序的客户端和服务器端构件的开发，在Web系统中得到了非常广泛的应用。下面对JavaScript进行简单的介绍。

###9.1.1　什么是JavaScript

JavaScript是由Netscape Communication Corporation（网景公司）开发的，是一种基于对象和事件驱动并具有安全性能的解释型脚本语言。它不但可用于编写客户端的脚本程序，由Web浏览器解释执行，而且还可以编写在服务器端执行的脚本程序，在服务器端处理用户提交的信息并动态地向浏览器返回处理结果。

9.1.2　JavaScript的功能
JavaScript是比较流行的一种制作网页特效的脚本语言，它由客户端浏览器解释执行，可以应用在PHP、ASP、JSP和ASP.NET网站中，目前比较热门的Ajax就是以JavaScript为基础，由此可见，熟练掌握并应用JavaScript对于网站开发人员非常重要。

JavaScript主要应用于以下几个方面：
* 在网页中加入JavaScript脚本代码，可以使网页具有动态交互的功能，便于网站与用户间的沟通，及时响应用户的操作，对提交的表单做即时检查，如验证表单元素是否为空，验证表单元素是否为数值型，检测表单元素是否输入错误等。
* 应用JavaScript脚本制作网页特效，如动态的菜单、浮动的广告等，为页面增添绚丽的动态效果，使网页内容更加丰富、活泼。
* 应用JavaScript脚本建立复杂的网页内容，如打开新窗口载入网页。
* 应用JavaScript脚本可以对用户的不同事件产生不同的响应。
* 应用JavaScript制作各种各样的图片、文字、鼠标、动画和页面的效果。
* 应用JavaScript制作一些小游戏。


##9.2　JavaScript语言基础
JavaScript脚本语言与其他语言一样，有其自身的基本数据类型、表达式和运算符以及程序的基本框架结构。通过本节的学习，读者可以掌握更多的JavaScript脚本语言的基础知识。


###9.2.1　JavaScript数据类型
JavaScript主要有6种数据类型
标识|名称
---|---
String|字符串
Number|数值
Boolean|布尔值
Null|空值
Undefined|未定义
Object|对象


###9.2.2　JavaScript变量
变量是指程序中一个已经命名的存储单元，它的主要作用就是为数据操作提供存放信息的容器。在使用变量前，必须明确变量的命名规则、变量的声明方法及变量的作用域。

1．变量的命名规则
JavaScript变量的命名规则如下
* 必须以字母或下划线开头，中间可以是数字、字母或下划线。
* 变量名不能包含空格或加号、减号等符号。
* JavaScript的变量名是严格区分大小写的。例如，User与user代表两个不同的变量。
* 不能使用JavaScript中的关键字。

JavaScript中的关键字:
break、case、catch、continue、default、delete、do、else、finally、for、function、if
in、instanceof、new、return、switc、hthis、throw、try、typeof、var、void、while、with

虽然JavaScript的变量可以任意命名，但为了在编程时使代码更加规范，最好使用便于记忆且有意义的变量名称，以增加程序的可读性。

2.变量的声明与赋值
在JavaScript中，一般使用变量前需要先声明变量，但有时变量可以不必先声明，在使用时根据变量的实际作用来确定其所属的数据类型。所有的JavaScript变量都由关键字var声明。
语法如下：`var variable;`
在声明变量的同时也可以对变量进行赋值：`var variable=11;`
建议读者在使用变量前就对其声明，因为声明变量的最大好处就是能及时发现代码中的错误。由于JavaScript是采用动态编译的，而动态编译是不易于发现代码中的错误的，特别是变量命名方面的错误。

声明变量时所遵循的规则如下：
* 可以使用一个关键字var同时声明多个变量，例如：`var i,j;`
* 可以在声明变量的同时对其赋值，即为初始化，例如：`var i=1;j=100;`
* 如果只是声明了变量，并未对其赋值，则其值默认为undefined。
在JavaScript中，可以使用分号代表一个语句的结束，如果每个语句都在不同的行中，那么分号可以省略；如果多个语句在同一行中，那么分号就不能省略。建议读者不省略分号，以养成良好的编程习惯。

在程序开发过程中，可以使用var语句多次声明同一个变量，如果重复声明的变量已经有一个初始值，那么此时的声明变量就相当于对变量重新赋值。


###9.2.3　JavaScript注释
1．单行注释
单行注释使用“//”进行标识。“//”符号后面的文字都不被程序解释执行。
2．多行注释
多行注释使用“/*…*/”进行标识。“/*…*/”符号中的文字不被程序解释执行。

多行注释“/*…*/”中可以嵌套单行注释“//”，但不能嵌套多行注释“/*…*/”。因为第一个“/*”会与其后面第一个“*/”相匹配，从而使后面的注释不起作用，甚至引起程序出错。

另外，JavaScript还能识别HTML注释的开始部分“<!--”，JavaScript会将其看作单行注释结束，如使用“//”一样。但JavaScript不能识别HTML注释的结尾部分“-->”。

这种现象存在的主要原因是：在JavaScript中，如果第一行以“<!--”开始，最后一行以“-->”结束，那么其间的程序就包含在一个完整的HTML注释中，会被不支持JavaScript的浏览器忽略掉，不能被显示。如果第一行以“<!--”开始，最后一行以“//-->”结束，JavaScript会将两行都忽略掉，而不会忽略这两行之间的部分。用这种方式可以针对那些无法理解JavaScript的浏览器而隐藏代码，而对那些可以理解JavaScript的浏览器则不必隐藏。


##9.3　自定义函数
自定义函数就是由用户自己命名并编写的能实现特定功能的程序单元。用户使用的自定义函数必须事先声明，不能直接使用没有声明过的自定义函数。
JavaScript用function来定义函数，语法格式如下：
`function 函数名(){ 函数体};`
自定义函数的调用方法是：`函数名();`
其中的括号一定不能省略。


##9.4　JavaScript流程控制语句
流程控制语句就是对语句中不同条件的值进行判断，从而根据不同的条件执行不同的语句。在JavaScript中，流程控制语句可以分为条件语句、循环语句和跳转语句。

9.4.1　条件语句
条件语句主要包括两种：一种是if条件语句，另一种是switch多分支语句。
在JavaScript中，可以使用单一的if条件语句，也可以使用两个或者多重选择的if条件语句。

1．if条件语句
if语句是最基本、最常用的条件控制语句。通过判断条件表达式的值为true或者false，来确定是否执行某一条语句。
语法格式如下：
`if(条件表达式){ 语句块}`
在if语句中，只有当条件表达式的值为true时，才会执行语句块中的语句，否则将跳过语句块，执行其他程序语句。其中，大括号“{}”的作用是将多条语句组成一个语句块，作为一个整体进行处理。如果语句块中只有一条语句，也可以省略大括号。一般情况下，建议不要省略大括号，养成使用大括号的习惯，以免出现程序错误。

2．switch分支语句
虽然使用if语句可以实现多分支的条件语句，但在选择分支比较多的情况下，使用if多分支条件语句就会降低程序的执行效率。JavaScript中的switch语句可以针对给出的表达式或者变量的不同值来选择执行的语句块，从而提高程序运行速度。

在switch语句中，首先计算表达式或变量的值，然后将此值与常量表达式1进行比较，如果两个值相等，则执行语句块1中的语句，然后执行break语句并跳出switch语句；如果此值与常量表达式1不相等，则将此值与常量表达式2进行比较，如果相等，则执行语句块2中的语句，并执行break语句跳出switch语句；如果与常量表达式2不相等，则继续与后面的常量表达式进行比较。如果表达式或变量的值与所有case语句后的常量表达式都不相等，则执行default中的语句块n+1。


###9.4.2　循环语句
循环语句的主要功能是在满足条件的情况下反复地执行某一个操作。循环语句主要包括while循环语句和for循环语句。

1．while循环语句
while语句是基本的循环语句，也是条件判断语句。在JavaScript中，while循环语句的应用比较广泛。
语法格式如下：`while(条件表达式){ 语句块}`
在while语句中，首先判断条件表达式的值，如果值为true则执行大括号内的语句块，执行完毕后再次判断条件表达式的值，如果值仍为true，则重复执行大括号内的语句块。这样一直循环，直到条件表达式的值为false时结束，执行while语句后面的其他代码。

在while语句的循环体中应包含改变条件表达式值的语句，否则条件表达式的值总为true，会造成死循环。


2．for循环语句
for语句是一种常用的循环控制语句。在for语句中，可以应用循环变量来明确循环的次数和具体的循环条件。for语句通常使用一个变量作为计数器来执行循环的次数，这个变量就称为循环变量。
语法格式如下：
`for(初始化循环变量;循环条件;确定循环变量的改变值){ 语句块;}`

在for语句的小括号中包含3部分内容：
* 初始化循环变量：该表达式的作用是声明循环变量并进行初始化赋值。在for语句之前也可以对循环变量进行声明和赋值。
* 循环条件：该表达式是基于循环变量的一个条件表达式，如果条件表达式的返回值为true，则执行循环体内的语句块。循环体内的语句执行完毕后将重新判断此表达式，直到条件表达式的返回值为false时终止循环。
* 确定循环变量的改变值：该条件表达式用于操作循环变量的改变值。每次执行完循环体内的语句后，在判断循环条件之前，都将执行此表达式。

for语句可以使用break语句来终止循环语句的执行。break语句默认情况下是终止当前的循环语句。


###9.4.3　跳转语句
跳转语句是在循环控制语句的循环体中的指定位置或是满足一定条件的情况下直接退出循环。JavaScript跳转语句分为break语句和continue语句。

1．break语句
break语句用来终止执行其后面的程序并跳出循环，或者结束switch语句。

2．continue语句
continue语句与break语句的作用不同。continue语句只跳出本次循环并立即进入下一次循环；break语句则跳出循环后结束整个循环。


##9.5　JavaScript事件
JavaScript是基于对象的语言，它的一个最基本的特征就是采用事件驱动。事件是某些动作发生时产生的信号，这些事件随时都可能发生。引起事件发生的动作称为触发事件，例如，当鼠标指针经过某个按钮、用户单击了某个链接、用户选中了某个复选框、用户在文本框中输入某些信息等，都会触发相应的事件。

JavaScript中的常用事件

事件名称|解释
---|---
鼠标事件|
onclick|点击某个对象时触发
ondblclick|双击某个对象时触发
onmouseover|鼠标移入某个元素时触发
onmouseout|鼠标移出某个元素时触发
onmouseenter|鼠标进入某个元素时触发
onmouseleave|鼠标离开某个元素时触发
onmousedown|鼠标按下时触发
onmouseup|鼠标抬起时触发
onmousemove|鼠标被移动时触发
onwheel|鼠标滚轮滚动时触发
oncontextmenu|点击鼠标右键时触发
键盘事件|
onkeydown|键盘的键按下时触发
onkeyup|键盘的键放开时触发
onkeypress|按下或按住键盘键时触发
框架/对象事件|
onresize|浏览器窗口大小改变时触发
onabort|图形的加载被中断时触发
onload|元素加载完时触发
onerror|当加载文档或者图片时（没找到）发生的错误时触发
onscroll|文档滚动时触发
onpageshow|用户访问页面时触发
onunload|用户退出页面时触发
表单事件|
onfocus|元素获得焦点时触发
onblur|元素失去焦点时触发
onchange|元素内容改变时触发
oninput|元素获取用户输入时触发
onsubmit|提交按钮时触发
onreset|重置按钮时触发
onselect|文本被选中时触发
拖动事件|
ondrag|元素正在拖动时触发
ondragend|用户完成元素拖动时触发
多媒体事件|
onplay|在视频/音频开始播放时触发
onended|在视频/音频播放结束时触发
onpause|在视频/音频暂停时触发


##9.6　调用JavaScript脚本（JavaScript脚本嵌入方式）

###9.6.1　在HTML中嵌入JavaScript脚本
JavaScript作为一种脚本语言，可以使用<script>标记嵌入到HTML文件中。
语法格式如下：
<script language="javascript">
…
</script>
应用<script>标记是直接执行JavaScript脚本最常用的方法，大部分含有JavaScript的网页都采用这种方法，其中，通过language属性可以设置脚本语言的名称和版本。

如果在<script>标记中未设置language属性，IE浏览器和Netscape浏览器将默认使用JavaScript脚本语言。


###9.6.2　应用JavaScript事件调用自定义函数
在Web程序开发过程中，经常需要在表单元素相应的事件下调用自定义函数。例如，在按钮的单击事件下调用自定义函数check()来验证表单元素是否为空，代码如下：
<input type="submit" name="Submit" value="检测" onClick="check();">
然后在该表单的当前页中编写一个check()自定义函数即可。


###9.6.3　在PHP动态网页中引用JS文件
在网页中，除了可在<script>与</script>标记之间编写JavaScript脚本代码，还可以通过<script>标记中的src属性指定外部的JavaScript文件（即JS文件，以.js为扩展名）的路径，从而引用对应的JS文件。
语法格式如下：<script src=url  language="Javascript"></script>
其中，url是JS文件的路径，“language="Javascript"”可以省略，因为<script>标记默认使用的就是JavaScript脚本语言。

JavaScript脚本不仅可以与HTML结合使用，同时也可以与PHP动态网页结合使用，其引用的方法是相同的。使用外部JS文件的优点如下：
* 使用JS文件可以将JavaScript脚本代码从网页中独立出来，便于代码的阅读。
* 一个外部JS文件，可以同时被多个页面调用。当共用的JavaScript脚本代码需要修改时，只需要修改JS文件中的代码即可，便于代码的维护。
* 通过<script>标记中的src属性不但可以调用同一个服务器上的JS文件，还可以通过指定路径来调用其他服务器上的JS文件。


在网页中引用JS文件需要注意的事项如下：
* 在JS文件中，只能包含JavaScript脚本代码，不能包含<script>标记和HTML代码。读者可参考例9.9中script.js文件的代码。
* 在引用JS文件的<script>与</script>标记之间不应存在其他的JavaScript代码，即使存在，浏览器也会忽略此脚本代码，而只执行JS文件中的JavaScript脚本代码。


###9.6.4　解决浏览器不支持JavaScript的问题
虽然大多数浏览器都支持JavaScript脚本，但仍有少部分浏览器不支持。如果遇到不支持JavaScript脚本的浏览器，网页会达不到预期效果或出现错误。解决这个问题可以使用以下3种方法。

1．开启IE浏览器对JavaScript的支持
2．开启IE浏览器对本地JavaScript的支持
3．应用注释符号验证浏览器是否支持JavaScript脚本功能
4．应用<noscript>标记验证浏览器是否支持JavaScript脚本


##9.7　在PHP中调用JavaScript脚本

###9.7.1　应用JavaScript脚本验证表单元素是否为空

###9.7.2　应用JavaScript脚本制作二级导航菜单

###9.7.3　应用JavaScript脚本控制文本域和复选框


##9.8　小结


##9.9　实践与练习


---


#第10章 日期和时间

##10.1　系统时区设置

###10.1.1　时区划分
整个地球分为24个时区，每个时区都有自己的本地时间。同一时间，每个时区的本地时间相差1～23个小时，例如，英国伦敦本地时间与北京本地时间相差8个小时。在国际无线电通信领域，使用一个统一的时间，称为通用协调时间（Universal Time Coordinated，UTC），UTC与格林尼治标准时间（Greenwich Mean Time，GMT）相同，都与英国伦敦的本地时间相同。


###10.1.2　时区设置
由于PHP 5对data()函数进行了重写，因此，目前的日期时间函数比系统时间少8个小时。在PHP语言中默认设置的是标准的格林尼治时间（即采用的是零时区），所以要获取本地当前的时间必须更改PHP语言中的时区设置。
更改PHP语言中的时区设置有两种方法：
* 修改php.ini文件中的设置，找到[date]下的“;date.timezone=”选项，将其修改为“date.timezone=Asia/Hong_Kong”，然后重新启动Apache服务器。
* 在应用程序中，在使用时间日期函数之前添加如下函数：`date_default_timezone_set(timezone);`
参数timezone为PHP可识别的时区名称，如果时区名称PHP无法识别，则系统采用UTC时区。在PHP手册中提供了各时区名称列表，其中，设置我国北京时间可以使用的时区包括：PRC（中华人民共和国）、Asia/Chongqing（重庆）、Asia/Shanghai（上海）或者Asia/Urumqi（乌鲁木齐），这几个时区名称是等效的。
设置完成后，date()函数便可以正常使用，不会再出现时差问题。

如果将程序上传到空间中，那么对系统时区设置时，不能修改php.ini文件，只能使用date_default_timezone_set()函数对时区进行设置。


##10.2　PHP日期和时间函数

###10.2.1　获得本地化时间戳
PHP应用mktime()函数将一个时间转换成UNIX的时间戳值。
mktime()函数根据给出的参数返回UNIX时间戳。时间戳是一个长整数，包含了从UNIX纪元（1970年1月1日）到给定时间的秒数。其参数可以从右向左省略，任何省略的参数会被设置成本地日期和时间的当前值。
该函数的语法格式如下：
`int mktime(int hour, int minute, int second, int month, int day, int year, int [is_dst])`

mktime()函数参数说明
参数|说明
---|---
hour|小时数
minute|分钟数
second|秒数
month|月份数
day|天数
year|年份
id_dst|可以被设置为1，不设置则为0，不确定是否是夏令时则为-1

###10.2.2　获取当前时间戳
PHP通过time()函数获取当前的UNIX时间戳，返回值为从UNIX纪元（格林尼治时间1970年1月1日00:00:00）到当前时间的秒数。
语法格式如下：`int time (void)`


###10.2.3　获取当前日期和时间
在PHP中通过date()函数获取当前的日期和时间。
date()函数的语法如下：`date(string format,int timestamp)`
date()函数将返回参数timestamp按照指定格式而产生的字符串。其中的参数timestamp是可选的，如果省略，则使用当前时间。format参数可以使开发人员按其指定的格式输出日期时间，关于format参数的格式化选项将在10.2.6节进行介绍，这里给出几个预定义常量，如表10.2所示，这几个常量提供了标准的日期表达方法，可用于日期格式函数。
函数|说明
---|---
DATE_ATOM|原子钟形式
DATE_COOKIE|HTTP cookie形式
DATE_ISO8601|ISO8601格式
DATE_RFC822|RFC822格式
DATE_RFC850|RFC850格式
DATE_RSS|RSS格式
DATA_W3C|W3C格式


###10.2.4　获取日期信息
日期是数据处理中经常使用到的信息之一。本节主要应用getdate()函数获取日期指定部分的相关信息。
getdate()函数的语法如下：`array getdate(int timestamp)`
getdate()函数返回数组形式的日期和时间信息，如果没有时间戳，则以当前时间为准。该函数返回的关联数组元素的说明
函数|说明
---|---
seconds|秒，返回值为0-59
minutes|分，返回值为0-59
hours|时，返回值为0-23
mday|月份的第几天，返回值为1-31
wday|星期中第几天，返回值为0-6
mon|月份数字，返回值为1-12
year|4位数字表示完整年份
yday|一年中的第几天，返回值为0-365
weekday|星期几的完整文本表示，返回值为Sunday-Saturday
month|月份的完整文本表示，返回值为January-December
0|返回从UNIX纪元开始的秒数


###10.2.5　检验日期的有效性
一年有12个月，一个月有31天（或30天，2月有28天，闰年为29天），一星期有7天……这些常识人人皆知。但计算机并不能自己分辨数据的对与错，只是依靠开发者提供的功能去执行或检查。PHP中内置了日期检查函数，就是checkdate()函数。checkdate()函数的语法如下：`bool checkdate(int month,int day,int year)`
其中，month的有效值为1～12；day的有效值为当月的最大天数，如1月为31天，2月为29天（闰年）；year的有效值为1～32767。


###10.2.6　输出格式化的日期和时间


###10.2.7　显示本地化的日期和时间
使用setlocale()函数和strftime()函数来设置本地化环境和格式化输出日期和时间。


1．setlocale()函数
setlocale()函数可以改变PHP默认的本地化环境。
语法格式如下：`string setlocale(string category, string locale)`
参数category的选项如表
参数|说明
---|---
LC_ALL|包含下面所有的本地化规则
LC_COLLATE|字符串比较
LC_CRYPE|字符串分类和转换，如转换大小写
LC_MONETARY|本地环境的货币形式
LC_NUMERIC|本地环境的数值形式
LC_TIME|本地环境的时间形式

参数locale如果为空，就会使用系统环境变量的locale或lang的值，否则就会应用locale参数所指定的本地化环境。如en_US为美国本地化环境，chs则指简体中文，cht为繁体中文。
对于Windows平台的用户，可以登录http://msdn.microsoft.com来获取语言和国家（地区）的编码列表。如果是UNIX/Linux系统，则可以使用命令locale-a来确定所支持的本地化环境。


2．strftime()函数
strftime()函数根据本地化环境设置来格式化输出日期和时间。
语法格式如下：`string strftime(string format, int timestamp)`
该函数返回用给定的字符串对参数timestamp进行格式化后输出的字符串。如果没有给出时间戳，则用本地时间。月份、星期以及其他和语言有关的字符串写法和setlocale()函数设置的当前区域有关。format参数识别的转换标记如表

对于strftime()函数，可能不是所有的转换标记都被C库文件支持，这种情况下PHP的strftime()也不支持。此外，不是所有的平台都支持负的时间戳，因此日期的范围可能限定在不早于UNIX纪元。这意味着，%e，%T，%R和%D（可能更多）以及早于Jan 1，1970的时间在Windows、Linux以及其他几个操作系统中无效。对于Windows系统，所支持的转换标记可在MSDN网站找到。


###10.2.8　将日期和时间解析为UNIX时间戳
PHP中应用strtotime()函数可将任何英文文本的日期和时间解析为UNIX时间戳，其值相对于now参数给出的时间，如果没有提供此参数则用系统当前时间。
strtotime()函数的语法如下：`int strtotime (string time [, int now])`
该函数有两个参数。如果参数time的格式是绝对时间，则now参数不起作用；如果参数time的格式是相对时间，那么其对应的时间就是参数now来提供的，如果没有提供参数now，对应的时间就为当前时间。如果解析失败，则返回false。在PHP 5.1.0之前，本函数在失败时返回-1。


##10.3　日期和时间的应用

###10.3.1　比较两个时间的大小
在实际开发中经常会对两个时间的大小进行判断，PHP中的时间是不可以直接进行比较的。所以，首先要将时间解析为时间戳的格式，然后再进行比较。

###10.3.2　实现倒计时功能


###10.3.3　计算页面脚本的运行时间
在浏览网站时，经常会用到搜索引擎，在搜索信息时，细心的用户会发现，在搜索结果的最下方，一般都有“搜索时间为×秒”的字样。
这里使用到了microtime()函数，该函数返回当前UNIX时间戳和微秒数。返回格式为msec sec的字符串，其中sec是当前的UNIX时间戳，msec为微秒数。
语法格式如下：`string microtime(void)`


##10.4　小结


##10.5　实践与练习


---

#第11章 Cookie与Session


##11.1　Cookie管理
Cookie是在HTTP协议下，服务器或脚本可以维护客户工作站上信息的一种方式。Cookie的使用很普遍，许多提供个人化服务的网站都是利用Cookie来区别不同用户，以显示与用户相应的内容，如Web接口的免费E-mail网站，就需要用到Cookie。有效地使用Cookie可以轻松完成很多复杂任务。


###11.1.1　了解Cookie
1．什么是Cookie
Cookie是一种在远程浏览器端存储数据并以此来跟踪和识别用户的机制。简单地说，Cookie是Web服务器暂时存储在用户硬盘上的一个文本文件，并随后被Web浏览器读取。当用户再次访问Web网站时，网站通过读取Cookies文件记录这位访客的特定信息（如上次访问的位置、花费的时间、用户名和密码等），从而迅速做出响应，如在页面中不需要输入用户的ID和密码即可直接登录网站等。
文本文件的命令格式如下：`用户名@网站地址[数字].txt`

`在Cookies文件夹下，每个Cookie文件都是一个简单而又普通的文本文件，而不是程序。Cookies中的内容大多都经过了加密处理，因此，表面看来只是一些字母和数字组合，而只有服务器的CGI处理程序才知道它们真正的含义。`


2．Cookie的功能
Web服务器可以应用Cookies包含信息的任意性来筛选并经常性维护这些信息，以判断在HTTP传输中的状态。Cookie常用于以下3个方面：
* 记录访客的某些信息。如可以利用Cookie记录用户访问网页的次数，或者记录访客曾经输入过的信息，另外，某些网站可以使用Cookie自动记录访客上次登录的用户名。
* 在页面之间传递变量。浏览器并不会保存当前页面上的任何变量信息，当页面被关闭时页面上的所有变量信息将随之消失。如果用户声明一个变量id=8，要把这个变量传递到另一个页面，可以把变量id以Cookie形式保存下来，然后在下一页通过读取该Cookie来获取变量的值。
* 将所查看的Internet页存储在Cookies临时文件夹中，可以提高以后浏览的速度。

`一般不要用Cookie保存数据集或其他大量数据。并非所有的浏览器都支持Cookie，并且数据信息是以明文文本的形式保存在客户端计算机中，因此最好不要保存敏感的、未加密的数据，否则会影响网络的安全性。`


###11.1.2　创建Cookie

在PHP中通过setcookie()函数创建Cookie。在创建Cookie之前必须了解的是，Cookie是HTTP头标的组成部分，而头标必须在页面其他内容之前发送，它必须最先输出。若在setcookie()函数前输出一个HTML标记或echo语句，甚至一个空行都会导致程序出错。

语法格式如下：
`bool setcookie(string name[,string value[,int expire[, string path[,string domain[,int secure]]]]])`
setcookie()函数的参数说明如下
参数|说明
---|---
name|Cookie的变量名
value|Cookie变量的值，该值保存在客户端，不能用来保存数据
expire|Cookie的失效时间，expire是UNIX时间标记，可以用time()函数获取，单位为秒
path|Cookie在服务武器的有效路径
domain|Cookie有效域名
secure|指明Cookie是否通过安全HTTPS，值为0或1


###11.1.3　读取Cookie
在PHP中可以直接通过超级全局数组$_COOKIE[]来读取浏览器端的Cookie值。

使用isset()函数检测Cookie文件是否存在，如果不存在，则使用setcookie()函数创建一个Cookie，并输出相应的字符串；如果Cookie文件存在，则使用setcookie()函数设置Cookie文件失效的时间，并输出用户上次访问网站的时间。

如果未设置Cookie的到期时间，则在关闭浏览器时自动删除Cookie数据。如果为Cookie设置了到期时间，浏览器将会记住Cookie数据，即使用户重启计算机，只要没到期，再访问网站时也会获得数据信息。


###11.1.4　删除Cookie
当Cookie被创建后，如果没有设置它的失效时间，其Cookie文件会在关闭浏览器时被自动删除。如果要在关闭浏览器之前删除Cookie文件，方法有两种：一种是使用setcookie()函数删除，另一种是在浏览器中手动删除Cookie。下面分别进行介绍。

1．使用setcookie()函数删除Cookie
删除Cookie和创建Cookie的方式基本类似，删除Cookie也使用setcookie()函数。删除Cookie只需要将setcookie()函数中的第二个参数设置为空值，将第三个参数Cookie的过期时间设置为小于系统的当前时间即可。
`把过期时间设置为0，可以直接删除Cookie。`

2．在浏览器中手动删除Cookie
在使用Cookie时，Cookie自动生成一个文本文件存储在IE浏览器的Cookies临时文件夹中。在浏览器中删除Cookie文件是非常便捷的方法。

###11.1.5　Cookie的生命周期
如果Cookie不设定时间，就表示它的生命周期为浏览器会话的期间，只要关闭IE浏览器，Cookie就会自动消失。这种Cookie被称为会话Cookie，一般不保存在硬盘上，而是保存在内存中。

如果设置了过期时间，那么浏览器会把Cookie保存到硬盘中，再次打开IE浏览器时会依然有效，直到它的有效期超时。

虽然Cookie可以长期保存在客户端浏览器中，但也不是一成不变的。因为浏览器最多允许存储300个Cookie文件，而且每个Cookie文件支持最大容量为4KB；每个域名最多支持20个Cookie，如果达到限制时，浏览器会自动地随机删除Cookies。


##11.2　Session管理
对比Cookie，会话文件中保存的数据是在PHP脚本中以变量的形式创建的，创建的会话变量在生命周期（20分钟）中可以被跨页的请求所引用。另外，Session是存储在服务器端的会话，相对安全，并且不像Cookie那样有存储长度的限制。


###11.2.1　了解Session
1．什么是Session
Session译为“会话”，其本义是指有始有终的一系列动作/消息，如打电话时从拿起电话拨号到挂断电话这一系列过程可以称为一个Session。
在计算机专业术语中，Session是指一个终端用户与交互系统进行通信的时间间隔，通常指从注册进入系统到注销退出系统所经过的时间。因此，Session实际上是一个特定的时间概念。

2．Session工作原理
当启动一个Session会话时，会生成一个随机且唯一的session_id，也就是Session的文件名，此时session_id存储在服务器的内存中，当关闭页面时此id会自动注销，重新登录此页面，会再次生成一个随机且唯一的id。

3．Session的功能
Session在Web技术中非常重要。由于网页是一种无状态的连接程序，因此无法得知用户的浏览状态。通过Session则可记录用户的有关信息，以供用户再次以此身份对Web服务器提交要求时作确认。例如，在电子商务网站中，通过Session记录用户登录的信息，以及用户所购买的商品，如果没有Session，那么用户每进入一个页面都需要登录一次用户名和密码。

另外，Session会话适用于存储信息量比较少的情况。如果用户需要存储的信息量相对较少，并且对存储内容不需要长期存储，那么使用Session把信息存储到服务器端比较合适。


###11.2.2　创建会话
创建一个会话需要通过以下步骤：`启动会话→注册会话→使用会话→删除会话`

1．启动会话
启动PHP会话的方式有两种：一种是使用session_start()函数，另一种是使用session_register()函数，为会话登录一个变量来隐含地启动会话。

在PHP中有两种方法可以创建会话。
通常，session_start()函数在页面开始位置调用，然后会话变量被登录到数据$_SESSION
通过session_start()函数创建会话。
语法格式如下：`bool session_start(void) ;`
`使用session_start()函数之前浏览器不能有任何输出，否则会产生错误。`

`使用session_register()函数时，不需要调用session_start()函数，PHP会在注册变量之后隐含地调用session_start()函数。`


2．注册会话
会话变量被启动后，全部保存在数组$_SESSION中。通过数组$_SESSION创建一个会话变量很容易，只要直接给该数组添加一个元素即可。


3．使用会话
首先需要判断会话变量是否有一个会话ID存在，如果不存在，就创建一个，并且使其能够通过全局数组$_SESSION进行访问。如果已经存在，则将这个已注册的会话变量载入以供用户使用。


4．删除会话
删除会话的方法主要有删除单个会话、删除多个会话和结束当前会话3种，下面分别进行介绍。
* 删除单个会话:删除会话变量，同数组的操作一样，直接注销$_SESSION数组的某个元素即可。
* 删除多个会话:如果想要一次注销所有的会话变量，可以将一个空的数组赋值给$_SESSION
* 结束当前会话:如果整个会话已经结束，首先应该注销所有的会话变量，然后使用session_destroy()函数清除结束当前的会话，并清空会话中的所有资源，彻底销毁Session

`使用unset()函数时，要注意$_SESSION数组中某元素不能省略，即不可以一次注销整个数组，这样会禁止整个会话的功能，如unset($_SESSION)函数会将全局变量$_SESSION销毁，而且没有办法将其恢复，用户也不能再注册$_SESSION变量。如果要删除多个或全部会话，可以采后面两种方式。`


###11.2.3　Session设置时间

1．客户端没有禁止Cookie
使用session_set_cookie_params()设置Session的失效时间，此函数是Session结合Cookie设置失效时间
session_set_cookie_params()必须在session_start()之前调用。
不推荐使用session_set_cookie_params()函数，此函数在一些浏览器上会出现问题。所以一般手动设置失效时间。

使用setcookie()函数可对Session设置失效时间

2．客户端禁止Cookie
当客户端禁用Cookie时，Session页面间传递会失效。
解决这个问题有4种方法：
（1）在登录之前提醒用户必须打开Cookie，这是很多论坛的做法。
（2）设置php.ini文件中的session.use_trans_sid=1，或者编译时打开-enable-trans-sid选项，让PHP自动跨页面传递session_id。
（3）通过GET方法，隐藏表单传递session_id。
（4）使用文件或者数据库存储session_id，在页面传递中手动调用。

`Session原理为请求该页面之后会产生一个session_id，如果这个时候禁止了Cookie就无法传递session_id，在请求下一个页面时将会重新产生一个session_id，这样就造成了Session在页面间传递失效。`


###11.2.4　通过Session判断用户的操作权限
在大多数网站的开发过程中，需要对管理员和普通用户操作网站的权限进行划分。


##11.3　Session高级应用

###11.3.1　Session临时文件
在服务器中，如果将所有用户的Session都保存到临时目录中，会降低服务器的安全性和效率，打开服务器存储的站点会非常慢。

###11.3.2　Session缓存
Session的缓存是将网页中的内容临时存储到IE客户端的Temporary Internet Files文件夹下，并且可以设置缓存的时间。当第一次浏览网页后，页面的部分内容在规定的时间内就被临时存储在客户端的临时文件夹中，这样在下次访问这个页面时，就可以直接读取缓存中的内容，从而提高网站的浏览效率。
Session缓存的完成使用的是session_cache_limiter()函数，其语法如下：
`string session_cache_limiter([string cache_limiter])`
其中，cache_limiter为public或private。同时，Session缓存并不是指在服务器端而是客户端缓存，在服务器中没有显示。

缓存时间的设置使用的是session_cache_expire()函数，其语法如下：
`int session_cache_expire([int new_cache_expire])`
其中，new_cache_expire是Session缓存的时间数字，单位是分钟。


`这两个Session缓存函数必须在session_start()调用之前使用，否则会出错。`


###11.3.3　Session数据库存储
虽然通过改变Session存储文件夹使Session不至于将临时文件夹填满而造成站点瘫痪，但是可以计算一下如果一个大型网站一天登录1000人，一个月登录了30000人，这时站点中存在30000个Session文件，要在这30000个文件中查询一个session_id应该不是件轻松的事情，那么这时就可以应用Session数据库存储，也就是PHP中的session_set_save_handler()函数。

语法格式如下：
`bool session_set_save_handler(string open, string close, string read, string write, string destroy, string gc)`
session_set_save_handler()函数的参数说明如下
参数|说明
---|---
open(save_path, session_name)|找到Session存储地址，取出变量名称
close()|关闭数据库
read(key)|读取session，key对应session_id
write(key,data)|其中data对应设置的Session变量
destroy(key)|注销Session对应的Session键值
gc(expiry_time)|清除过期的Session记录

一般应用参数直接使用变量，但是此函数中参数为6个函数，而且在调用时只是调用函数名称的字符串。下面将分别讲解这6个参数（函数），最后把这些封装进类中，等学习完面向对象编程后就会有一个非常清晰的印象。

```
<?php
// 封装_session_open()函数，连接数据库
function _session_open($save_path,$session_name)
{
	global $handle;
	$handle = mysqli_connect('localhost','root','123456') or die('数据库链接失败');
	mysqli_select_db($handle,'db_database11') or die('数据库中没有该数据库');
	return(true);
}

// 封装_session_close()函数，关闭数据库连接
// 在这个函数中不需要任何参数，所以不论是Session存储到数据库还是文件中，只需返回true即可。但是如果是MySQL数据库，最好是将数据库关闭，以保证以后不会出现麻烦。
function _session_close()
{
	global $handle;
	mysqli_close($handle);
	return(true);
}

// 封装_session_read()函数，在函数中设定当前时间的UNIX时间戳，根据$key值查找Session名称及内容
function _session_read($key)
{
	global $handle;	
	$time = time();
	$sql = "select session_data from tb_session where session_key = '$key' and session_time > $time";
	$result = mysqli_query($handle,$sql);
	$row = mysqli_fetch_array($result);
	if ($row)
		return($row['session_data']);
	else
		return(false);
}

// 封装_session_write()函数，函数中设定Session失效时间，查找到Session名称及内容，如果查询结果为空，则将页面中的Session根据session_id、session_name、失效时间插入数据库；如果查询结果不为空，则根据$key修改数据库中Session的存储信息，返回执行结果
function _session_write($key,$data)
{
	global $handle;
	$time = 60*60;
	$lapse_time = time() + $time;
	$handle = mysqli_connect('localhost','root','123') or die('数据库链接失败');
	mysqli_select_db($handle,'db_database11') or die('数据库没有此库名');	
	$sql = "select session_data from tb_session where session_key = '$key' and session_time > $lapse_time";
	$result = mysqli_query($handle,$sql);
	if (mysqli_num_rows($result) == 0)
	{
		$sql = "insert into tb_session values('$key','$data',$lapse_time)";	
		$result = mysqli_query($handle,$sql);
	}else
	{
		$sql = "update tb_session set session_key = '$key',session_data = '$data',session_time = $lapse_time where session_key = '$key'";												// �޸����ݿ�sql���
		$result = mysqli_query($handle,$sql);
	}
	return($result);
}

// 封装_session_destroy()函数，根据$key值将数据库中的Session删除
function _session_destroy($key)
{
	global $handle;
	$sql = "delete from tb_session where session_key = '$key'";
	$result = mysqli_query($handle,$sql);
	return($result);
}

// 封装_session_gc()函数，根据给出的失效时间删除过期Session
function _session_gc()
{
	global $handle;
	$lapse_time = time();
	$sql = "delete from tb_session where session_time < $lapse_time";
	$result = mysqli_query($handle,$sql);
	return($result);
}

session_set_save_handler('_session_open','_session_close','_session_read','_session_write','_session_destroy','_session_gc');

session_start();

$_SESSION['user'] = 'mr';
$_SESSION['pwd'] = 'mrsoft';
?>
````

---
























